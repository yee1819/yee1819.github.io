<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SpringBoot相关 | Kirari</title><meta name="author" content="Kirari"><meta name="copyright" content="Kirari"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一些SpringBoot相关的笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot相关">
<meta property="og:url" content="http://example.com/posts/f7006e66.html">
<meta property="og:site_name" content="Kirari">
<meta property="og:description" content="一些SpringBoot相关的笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com//blog202407130706428.webp">
<meta property="article:published_time" content="2024-06-12T21:04:17.000Z">
<meta property="article:modified_time" content="2024-07-12T23:08:00.249Z">
<meta property="article:author" content="Kirari">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com//blog202407130706428.webp"><link rel="shortcut icon" href="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com/%5CmarkdownImage_1702755412321.png"><link rel="canonical" href="http://example.com/posts/f7006e66.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"这篇文章距离上一次更新已经过了","messageNext":"天 , 请注意内容是否有效"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SpringBoot相关',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-13 07:08:00'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/fontFamily.css"><link href="https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/lxgwwenkaiscreen.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/footer_kirari.css"><link rel="stylesheet" href="/css/article_all_index.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com/%5CmarkdownImage_1702755412321.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw far fa-bookmark"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/posts/1ec2913a.html"><i class="fa-fw fas fa-thumbs-up"></i><span> 推荐文章</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-camera"></i><span> 图片</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://music.kiko2568.top"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://life.kiko2568.top/index.php/category/shuoshuo/"><i class="fa-fw fas fa-mug-hot"></i><span> 动态</span></a></li><li><a class="site-page child" href="/Blogtimeline/"><i class="fa-fw fas fa-hourglass-half"></i><span> 博客时光机</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://chat.kiko2568.top/"><i class="fa-fw fas fa-robot"></i><span> KioChat</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://yee-1312555989.cos.ap-guangzhou.myqcloud.com//blog202407130706428.webp')"><nav id="nav"><div class="kirari-nav-box"><span id="blog-info"><a href="/" title="Kirari"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com/%5CmarkdownImage_1702755412321.png"/><span class="site-name">Kirari</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw far fa-bookmark"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/posts/1ec2913a.html"><i class="fa-fw fas fa-thumbs-up"></i><span> 推荐文章</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-camera"></i><span> 图片</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://music.kiko2568.top"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://life.kiko2568.top/index.php/category/shuoshuo/"><i class="fa-fw fas fa-mug-hot"></i><span> 动态</span></a></li><li><a class="site-page child" href="/Blogtimeline/"><i class="fa-fw fas fa-hourglass-half"></i><span> 博客时光机</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://chat.kiko2568.top/"><i class="fa-fw fas fa-robot"></i><span> KioChat</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">SpringBoot相关</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-06-12T21:04:17.000Z" title="发表于 2024-06-13 05:04:17">2024-06-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-12T23:08:00.249Z" title="更新于 2024-07-13 07:08:00">2024-07-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">18.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>85分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SpringBoot相关"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>很混乱的SpringBoot合集</p>
<p>想着整理但是没啥时间整理</p>
<p>往后整理也是到vitepress的那个站点整理了吧</p>
</blockquote>
<h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><h2 id="Bean"><a href="#Bean" class="headerlink" title="Bean"></a>Bean</h2><p>IOC : 控制反转。对象的创建由程序交给外部容器</p>
<p>DI：依赖注入。容器为应用程序运行时，所依赖的资源为依赖注入</p>
<p>Bean对象：IOC容器中创建管理的对象为Bean</p>
<p><code>@Component</code>：注解在类上，标志为Bean对象，使用IOC容器管理</p>
<p><code>@Component</code>为通用注解</p>
<p>衍生注解，标注作用，不属于以下三种则使用<code>@Component</code></p>
<ul>
<li><p><code>@Repository</code>持久层</p>
</li>
<li><p><code>@Controller</code> 控制层</p>
</li>
<li><code>@Service</code>服务层</li>
</ul>
<p>其中控制层<code>@RestController</code>=<code>@ResponseBody</code>+<code>@Controller</code>,使用<code>@RestController</code>就可以了</p>
<h3 id="Bean的名字："><a href="#Bean的名字：" class="headerlink" title="Bean的名字："></a>Bean的名字：</h3><p>默认类名首字母小写，如User的bean为user</p>
<p>设置<code>@Component(&quot;uuser&quot;)</code>、<code>@Component(value = &quot;uuser&quot;)</code></p>
<h3 id="Bean扫描"><a href="#Bean扫描" class="headerlink" title="Bean扫描"></a>Bean扫描</h3><p>SpringBoot 默认扫描启动类当前包以及子包</p>
<p>如果想要扫描其他包则使用</p>
<p>单个包：<code>@ComponentScan(&quot;com.kirari.dashijian.dao&quot;)</code></p>
<p>多个包：<code>@ComponentScan(&#123;&quot;com.kirari.dashijian.dao&quot;,&quot;com.kirari.dashijian&quot;&#125;)</code></p>
<h3 id="获取Bean"><a href="#获取Bean" class="headerlink" title="获取Bean"></a>获取Bean</h3><h4 id="自动配置的三种方法"><a href="#自动配置的三种方法" class="headerlink" title="自动配置的三种方法"></a>自动配置的三种方法</h4><blockquote>
<p>想要自动配置，类上一定要有被String容器标记为Bean的<code>@Component</code>及其子注解或配置类<code>@Configuration</code></p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Resource</span></span><br><span class="line">    StringRedisTemplate stringRedisTemplate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个例子中<code>LoginInterceptor</code>没有<code>@Component</code>注解，不是Bean，不可以使用自动配置</p>
</blockquote>
<h5 id="AUtowired"><a href="#AUtowired" class="headerlink" title="@AUtowired"></a><code>@AUtowired</code></h5><p>自动配置默认按照类型进行装配，默认的Bean的名字是Bean类名的首字母小写。</p>
<p>默认自动装配时，会按照与Bean名相同的变量名进行查找匹配</p>
<p>定义一个<code>Service</code>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Tttest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">name</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现俩个Bean的实现类</p>
<p>t1:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">t1</span> <span class="keyword">implements</span> <span class="title class_">Tttest</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">name</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;t1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>t2:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">t2</span> <span class="keyword">implements</span> <span class="title class_">Tttest</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">name</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;t2&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">UserService userService1;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">Tttest t1;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">Tttest t2;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBean</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(t1.name());</span><br><span class="line">    System.out.println(t1);</span><br><span class="line">    System.out.println(t2.name());</span><br><span class="line">    System.out.println(t2);</span><br><span class="line">    System.out.println(<span class="string">&quot;Service1&quot;</span>);</span><br><span class="line">    System.out.println(userService1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">t1</span><br><span class="line">com.kirari.dashijian.service.impl.t1@531ed68e</span><br><span class="line">t2</span><br><span class="line">com.kirari.dashijian.service.impl.t2@551976c2</span><br><span class="line">Service1</span><br><span class="line">com.kirari.dashijian.service.UserService@72e5206</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>可以见到t1、t2虽然是同一个类型的Bean，因为变量名和Bean默认名称一样，所以能找到</p>
<hr>
<p>如果在有同个类型的多个Bean的情况命名不是默认Bean名称的话出异常,例如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">Tttest tt;</span><br></pre></td></tr></table></figure>
<p>显示无法自动装配。存在多个 ‘Tttest’ 类型的 Bean。Beans: <code>t1   (t1.java)</code>、<code>t2   (t2.java)</code>、<code>tttest   (Tttest.java)</code></p>
<p>通过<code>@Qualifier</code>指定name</p>
<p>在上面的代码测试类中加入这段</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;t1&quot;)</span></span><br><span class="line">Tttest tt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBean</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(t1.name());</span><br><span class="line">    System.out.println(t1);</span><br><span class="line">    System.out.println(t2.name());</span><br><span class="line">    System.out.println(t2);</span><br><span class="line">    System.out.println(tt.name());</span><br><span class="line">    System.out.println(tt);</span><br><span class="line">    System.out.println(<span class="string">&quot;Service1&quot;</span>);</span><br><span class="line">    System.out.println(userService1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">t1</span><br><span class="line">com.kirari.dashijian.service.impl.t1@30b0f674</span><br><span class="line">t2</span><br><span class="line">com.kirari.dashijian.service.impl.t2@62818ab0</span><br><span class="line">t1</span><br><span class="line">com.kirari.dashijian.service.impl.t1@30b0f674</span><br><span class="line">Service1</span><br><span class="line">com.kirari.dashijian.service.UserService@7fda84cf</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="Inject"><a href="#Inject" class="headerlink" title="@Inject"></a><code>@Inject</code></h5><p>与<code>Autowired</code>几乎一模一样，按照类型注入，以默认名称匹配，多个同类型Bean时</p>
<p>不同的是提供注解的依赖不同，提供名称的注解不同</p>
<p>引入依赖，但是我没引入也能运行，不知道是不是springboot自动引入了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.inject<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.inject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试类中修改为Inject</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Inject</span></span><br><span class="line">   Tttest t1;</span><br><span class="line">   <span class="meta">@Inject</span></span><br><span class="line">   Tttest t2;</span><br><span class="line">   <span class="meta">@Inject</span></span><br><span class="line">   <span class="meta">@Named(&quot;t2&quot;)</span></span><br><span class="line">Tttest tt;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBean</span><span class="params">()</span>&#123;</span><br><span class="line">       System.out.println(t1.name());</span><br><span class="line">       System.out.println(t1);</span><br><span class="line">       System.out.println(t2.name());</span><br><span class="line">       System.out.println(t2);</span><br><span class="line">       System.out.println(tt.name());</span><br><span class="line">       System.out.println(tt);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">t1</span><br><span class="line">com.kirari.dashijian.service.impl.t1@62818ab0</span><br><span class="line">t2</span><br><span class="line">com.kirari.dashijian.service.impl.t2@39f5eba4</span><br><span class="line">t2</span><br><span class="line">com.kirari.dashijian.service.impl.t2@39f5eba4</span><br></pre></td></tr></table></figure>
<p>使用<code>Named(&quot;name&quot;)</code>进行指定bean</p>
<hr>
<h5 id="Resource"><a href="#Resource" class="headerlink" title="@Resource"></a><code>@Resource</code></h5><p>与<code>Autowired</code>和<code>Inject</code>不同，<code>Resource</code>是根据名称装配bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">Tttest t1;</span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line">Tttest t2;</span><br><span class="line"><span class="meta">@Resource(name = &quot;t1&quot;)</span></span><br><span class="line">Tttest tt;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBean</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(t1.name());</span><br><span class="line">    System.out.println(t1);</span><br><span class="line">    System.out.println(t2.name());</span><br><span class="line">    System.out.println(t2);</span><br><span class="line">    System.out.println(tt.name());</span><br><span class="line">    System.out.println(tt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">t1</span><br><span class="line">com.kirari.dashijian.service.impl.t1@3c070ade</span><br><span class="line">t2</span><br><span class="line">com.kirari.dashijian.service.impl.t2<span class="meta">@bb3487c</span></span><br><span class="line">t1</span><br><span class="line">com.kirari.dashijian.service.impl.t1@3c070ade</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="通过IOC容器对象获取Bean"><a href="#通过IOC容器对象获取Bean" class="headerlink" title="通过IOC容器对象获取Bean"></a>通过IOC容器对象获取Bean</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">ApplicationContext context ;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBean</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Tttest</span> <span class="variable">test1</span> <span class="operator">=</span> (Tttest) context.getBean(<span class="string">&quot;t1&quot;</span>);<span class="comment">//根据bean名</span></span><br><span class="line">    <span class="type">Tttest</span> <span class="variable">test2</span> <span class="operator">=</span> context.getBean(Tttest.class);<span class="comment">//根据类型</span></span><br><span class="line">    <span class="type">Tttest</span> <span class="variable">test3</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;t1&quot;</span>,Tttest.class);<span class="comment">//俩者一起使用</span></span><br><span class="line"></span><br><span class="line">    System.out.println(test1);</span><br><span class="line">    System.out.println(test2);</span><br><span class="line">    System.out.println(test3);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>在多个同类型bean中，一三方法可以实现找到不同的bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Tttest</span> <span class="variable">test1</span> <span class="operator">=</span> (Tttest) context.getBean(<span class="string">&quot;t1&quot;</span>);</span><br><span class="line"><span class="type">Tttest</span> <span class="variable">test3</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;t2&quot;</span>,Tttest.class);   </span><br><span class="line">System.out.println(test1);</span><br><span class="line">System.out.println(test3);</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.kirari.dashijian.service.impl.t1@56e9126f</span><br><span class="line">com.kirari.dashijian.service.impl.t2@4e773b8a</span><br></pre></td></tr></table></figure>
<p>在多个同类型Bean的时候使用二方法会报错，不知道使用哪个bean</p>
<h3 id="Bean重复"><a href="#Bean重复" class="headerlink" title="Bean重复"></a>Bean重复</h3><p>由于<code>@Autowired</code>是默认按照类型自动装配</p>
<p>如果同类型bean存在多个</p>
<ul>
<li><p><code>@Primary</code>指定装配 的bean</p>
<p>例如我有几个bean是同类型</p>
<ol>
<li> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">pppp</span> <span class="keyword">implements</span> <span class="title class_">UserMapper</span></span><br></pre></td></tr></table></figure>
</li>
<li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">uuuu</span> <span class="keyword">implements</span> <span class="title class_">UserMapper</span> </span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<p>​    此时使用<code>@Autowire</code>时,程序并不知道我使用哪个Bean，只要在需要使用的Bean上加上<code>@Primary</code>就会使用<code>@Primary</code>标记的Bean了</p>
<ul>
<li><p><code>@Qualifier</code>+<code>@Autowired</code>设置bean的名字</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;uuuu&quot;)</span></span><br><span class="line"><span class="keyword">private</span> UserMapper userMapper;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>@Resource(name = &quot;&quot;)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource(name = &quot;uuuu&quot;)</span></span><br><span class="line"><span class="keyword">private</span> UserMapper userMapper;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>@Inject</code>和<code>@Named(&quot;name&quot;)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Named(&quot;t1&quot;)</span></span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line">Tttest tt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Resource和-Autowired、-Inject的区别"><a href="#Resource和-Autowired、-Inject的区别" class="headerlink" title="@Resource和@Autowired、@Inject的区别"></a><code>@Resource</code>和<code>@Autowired</code>、<code>@Inject</code>的区别</h4><ul>
<li><p>提供的依赖不同</p>
</li>
<li><p>自动获得的逻辑不同</p>
</li>
<li>….</li>
</ul>
<h3 id="Bean的作用域范围"><a href="#Bean的作用域范围" class="headerlink" title="Bean的作用域范围"></a>Bean的作用域范围</h3><div class="table-container">
<table>
<thead>
<tr>
<th>作用域</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>singleton</td>
<td>（默认）容器内的同名称bean只有一个实例</td>
</tr>
<tr>
<td>prototype</td>
<td>每次使用这个bean重新创建新的实例</td>
</tr>
<tr>
<td>request</td>
<td>每个请求范围内创建新的实例</td>
</tr>
<tr>
<td>session</td>
<td>每个会话范围创建新的实例</td>
</tr>
<tr>
<td>application</td>
<td>每个应用范围内会创建新的实例</td>
</tr>
</tbody>
</table>
</div>
<h4 id="singleton"><a href="#singleton" class="headerlink" title="singleton"></a><code>singleton</code></h4><p>使用默认的singleton,即不设置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">ApplicationContext context ;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBean</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Tttest</span> <span class="variable">test3</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;t2&quot;</span>, Tttest.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(i+<span class="string">&quot;&quot;</span>+test3);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0com.kirari.dashijian.service.impl.t1@fdfd984</span><br><span class="line">1com.kirari.dashijian.service.impl.t1@fdfd984</span><br><span class="line">2com.kirari.dashijian.service.impl.t1@fdfd984</span><br><span class="line">3com.kirari.dashijian.service.impl.t1@fdfd984</span><br><span class="line">4com.kirari.dashijian.service.impl.t1@fdfd984</span><br><span class="line">5com.kirari.dashijian.service.impl.t1@fdfd984</span><br><span class="line">6com.kirari.dashijian.service.impl.t1@fdfd984</span><br><span class="line">7com.kirari.dashijian.service.impl.t1@fdfd984</span><br><span class="line">8com.kirari.dashijian.service.impl.t1@fdfd984</span><br><span class="line">9com.kirari.dashijian.service.impl.t1@fdfd984</span><br></pre></td></tr></table></figure>
<p>发现所有的bean实例都是同一个</p>
<h4 id="prototype"><a href="#prototype" class="headerlink" title="prototype"></a><code>prototype</code></h4><p>设置每次使用创建新的实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="comment">//@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">t2</span> <span class="keyword">implements</span> <span class="title class_">Tttest</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">name</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;t2&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">ApplicationContext context ;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBean</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Tttest</span> <span class="variable">test3</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;t2&quot;</span>, Tttest.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(i+<span class="string">&quot;&quot;</span>+test3);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0com.kirari.dashijian.service.impl.t2@186149f9</span><br><span class="line">1com.kirari.dashijian.service.impl.t2@5d4042fc</span><br><span class="line">2com.kirari.dashijian.service.impl.t2@6b06da60</span><br><span class="line">3com.kirari.dashijian.service.impl.t2@1be62793</span><br><span class="line">4com.kirari.dashijian.service.impl.t2@9da8b97</span><br><span class="line">5com.kirari.dashijian.service.impl.t2@56527ff2</span><br><span class="line">6com.kirari.dashijian.service.impl.t2@b5a6a82</span><br><span class="line">7com.kirari.dashijian.service.impl.t2@21aa0ec5</span><br><span class="line">8com.kirari.dashijian.service.impl.t2@7cf1bf54</span><br><span class="line">9com.kirari.dashijian.service.impl.t2@3919e2d7</span><br></pre></td></tr></table></figure>
<p>每次都创建了新的实例</p>
<hr>
<blockquote>
<p>bean的创建实例默认是在启动类运行之后就开始了，使用<code>@Lazy</code>注解在Bean类上，可以延迟实例化，不在启动类运行的 时候实例化。</p>
<p>而是在bean被使用时实例化</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="comment">//@Primary</span></span><br><span class="line"><span class="meta">@Lazy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">t2</span> <span class="keyword">implements</span> <span class="title class_">Tttest</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">name</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;t2&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Bean注册"><a href="#Bean注册" class="headerlink" title="Bean注册"></a>Bean注册</h3><h4 id="Bean-1"><a href="#Bean-1" class="headerlink" title="@Bean"></a>@Bean</h4><p>定义在方法上，标记未Bean交给Spring IOC 容器进行管理</p>
<h4 id="import"><a href="#import" class="headerlink" title="@import"></a>@import</h4><p>引入需要被项目使用的Bean类</p>
<p>和Scan类似</p>
<h3 id="起步依赖"><a href="#起步依赖" class="headerlink" title="起步依赖"></a>起步依赖</h3><p>利用meavn的依赖传递实现</p>
<p>设置start包，导入了所需要的包…</p>
<h3 id="自动装配"><a href="#自动装配" class="headerlink" title="自动装配"></a>自动装配</h3><ol>
<li>类中设置<code>@Bean</code>为Bean</li>
<li>通过<code>AutoConfiguration</code>设置自动配置类，<code>@import</code>导入类</li>
<li></li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com//blogimage-20240531172217518.webp" alt="image-20240531172217518"></p>
<h4 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h4><p>TODO</p>
<ul>
<li>[ ] 待续…不过也不用续</li>
</ul>
<h4 id="自动配置原理"><a href="#自动配置原理" class="headerlink" title="自动配置原理"></a>自动配置原理</h4><ul>
<li>[ ] TODO待续</li>
</ul>
<h3 id="注册条件"><a href="#注册条件" class="headerlink" title="注册条件"></a>注册条件</h3><p><code>@Conditional</code></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>注解</th>
<th>条件</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@ConditionalOnClass</code></td>
<td>存在这个类才声明Bean</td>
</tr>
<tr>
<td><code>@ConditionalOnMissingBean</code></td>
<td>不存在这个类型的Bean声明这个Bean</td>
</tr>
<tr>
<td><code>@ConditionalOnProperty</code></td>
<td>配置文件环境存在对应属性时声明Bean</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
</div>
<p>定义在类、方法上，根据条件决定是否注册bean </p>
<p>指定类型使用<code>value</code>、指定名称使用<code>name</code>属性</p>
<h3 id="Component"><a href="#Component" class="headerlink" title="@Component"></a><code>@Component</code></h3><p>交给Ioc容器管理的对象</p>
<p>Spring 在扫描组件的时候会自动识别带有 <code>@Component</code> 及其派生注解的类，并将其实例化为 bean 并纳入 Spring 容器的管理。</p>
<p>常见的派生注解有 <code>@Controller</code>、<code>@Service</code>、<code>@Repository</code>，它们都是基于 <code>@Component</code> 的扩展。</p>
<p> <code>@Controller</code>、<code>@Service</code>、<code>@Repository</code>标注该类是控制层、服务层、DAO层。</p>
<h3 id="Bean和Component的区别"><a href="#Bean和Component的区别" class="headerlink" title="Bean和Component的区别"></a>Bean和Component的区别</h3><ol>
<li><code>@Bean</code></li>
</ol>
<p><code>@Bean</code> 注解用于方法级别，是在 <code>@Configuration</code> 注解的类中定义的。使用 <code>@Bean</code> 注解的方法将返回一个对象，该对象将被注册为 Spring 应用上下文中的 Bean。<code>@Bean</code> 注解通常用于配置和创建第三方库的 Bean 或者需要复杂初始化逻辑的 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MyService <span class="title function_">myService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MyRepository <span class="title function_">myRepository</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyRepositoryImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><code>@Component</code></li>
</ol>
<p><code>@Component</code> 注解用于类级别，是 Spring 的通用组件扫描注解。<code>@Component</code> 注解的类将自动检测并注册为 Spring 应用上下文中的 Bean。<code>@Component</code> 注解通常用于开发人员自己编写的类（如服务、仓库、控制器等）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    <span class="comment">// 实现服务逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="接收请求"><a href="#接收请求" class="headerlink" title="接收请求"></a>接收请求</h2><h3 id="简单请求"><a href="#简单请求" class="headerlink" title="简单请求"></a>简单请求</h3><p>原始web接收请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;httptest&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testhttp</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">pas</span>  <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> name+pas;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请求：<code>http://localhost:8080/httptest?name=小明&amp;password=123456</code></p>
<p>响应：小明123456</p>
<p>SpringBoot中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/request&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController2</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/spring&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> user <span class="title function_">returnUser3</span><span class="params">( String name,String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findIdUser(name,id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请求：<code>http://localhost:8080/request/spring?name=小明&amp;id=1</code></p>
<p>返回：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;小明&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>只需要保证请求参数和接受参数一致就行了</p>
<p>如果不一致可以使用：<code>@RequestParam</code>来修正</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/request&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController2</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/show&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> user <span class="title function_">returnUser2</span><span class="params">(<span class="meta">@RequestParam(name = &quot;Name&quot; ,defaultValue = &quot;小明&quot;)</span> String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findUser(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>defaultValue</code>指定默认值</p>
<p>请求：<code>http://localhost:8080/request/show?Name=小明</code> </p>
<p>不指定值会使用默认值：<code>http://localhost:8080/request/show</code>等价于上面那句</p>
<p>返回：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;小明&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>@RequestParam</code>的<code>required</code>默认为true，代表必须传入该参数，否则报错，可改为<strong>fasle</strong></p>
</blockquote>
<hr>
<p>多个参数可能传入一到俩个重载：<code>@RequestParam(required = false)</code>来判断是否有值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;user&gt; <span class="title function_">findAll</span><span class="params">(<span class="meta">@RequestParam(required = false)</span> String name,<span class="meta">@RequestParam(required = false)</span> String id)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (name != <span class="literal">null</span>&amp;&amp;id!=<span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">user</span> <span class="variable">user</span> <span class="operator">=</span> userService.findIdUser(name,id);</span><br><span class="line">        <span class="keyword">return</span> List.of(user);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(name != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="type">user</span> <span class="variable">user</span> <span class="operator">=</span> userService.findUser(name);</span><br><span class="line">        <span class="keyword">return</span> List.of(user);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(id != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findID(id);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findAllUser();</span><br><span class="line">            <span class="comment">// 如果请求中有name参数，则返回特定用户</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>http://localhost:8080/user</code></li>
</ul>
<ul>
<li><code>http://localhost:8080/user?name=小明</code></li>
<li><code>http://localhost:8080/user?id=1</code></li>
<li><code>http://localhost:8080/user?id=1&amp;name=小明</code></li>
</ul>
<h3 id="参数设为实体类"><a href="#参数设为实体类" class="headerlink" title="参数设为实体类"></a>参数设为实体类</h3><p>实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@TableName(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">user</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    String name,pass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> user <span class="title function_">returnUser4</span><span class="params">( user user)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userService.findIdUser(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请求：<code>http://localhost:8080/user?name=小明&amp;id=1</code></p>
<p>返回：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;小明&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Mapper的设置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;SELECT * FROM user WHERE name = #&#123;user.name&#125; AND id = #&#123;user.id&#125; &quot;)</span></span><br><span class="line">user <span class="title function_">findIdUser2</span><span class="params">(<span class="meta">@Param(&quot;user&quot;)</span> user user)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="复杂实体类"><a href="#复杂实体类" class="headerlink" title="复杂实体类"></a>复杂实体类</h4><p>第一个类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">user2</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    String name,pass;</span><br><span class="line">    Info info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>嵌套类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Info</span> &#123;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/class&quot;)</span></span><br><span class="line"><span class="keyword">public</span> user2 <span class="title function_">getuser2</span><span class="params">(user2 user22)</span>&#123;</span><br><span class="line">    System.out.println(user22.toString());</span><br><span class="line">    <span class="keyword">return</span> user22;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请求：<code>http://localhost:8080/class?name=小明&amp;id=1&amp;info.address=上海&amp;info.age=18</code></p>
<p>返回：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;小明&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;上海&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="数组参数"><a href="#数组参数" class="headerlink" title="数组参数"></a>数组参数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/array&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String[] getArray(String[] Hobby)&#123;</span><br><span class="line">    <span class="keyword">return</span> Hobby;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请求：<code>http://localhost:8080/array?Hobby=跳舞&amp;Hobby=唱歌&amp;Hobby=跑步</code></p>
<p>返回：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    <span class="string">&quot;跳舞&quot;</span>,</span><br><span class="line">    <span class="string">&quot;唱歌&quot;</span>,</span><br><span class="line">    <span class="string">&quot;跑步&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="集合参数"><a href="#集合参数" class="headerlink" title="集合参数"></a>集合参数</h3><p>需要用到<code>@RequestParam</code>绑定数据 ,不加注解回默认绑定数组，但此时没有数据，就会报错</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getList</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;String&gt; Hobby)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Hobby;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请求：<code>http://localhost:8080/list?Hobby=跳舞&amp;Hobby=唱歌&amp;Hobby=跑步</code></p>
<p>结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;跳舞&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;唱歌&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;跑步&quot;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<h3 id="日期参数"><a href="#日期参数" class="headerlink" title="日期参数"></a>日期参数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;date1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> LocalDateTime <span class="title function_">getDate1</span><span class="params">(<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span>LocalDateTime localDateTime)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> localDateTime;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@GetMapping(&quot;date2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> LocalDateTime <span class="title function_">getDate2</span><span class="params">(<span class="meta">@DateTimeFormat(pattern = &quot;yyyy.MM.dd HH.mm.ss&quot;)</span>LocalDateTime localDateTime)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> localDateTime;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@GetMapping(&quot;/date3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> LocalDateTime <span class="title function_">getDate3</span><span class="params">(<span class="meta">@RequestParam</span> <span class="meta">@DateTimeFormat(pattern = &quot;yyyy/MM/dd&quot;)</span> LocalDate localDate)</span> &#123;</span><br><span class="line">    <span class="comment">// 将 LocalDate 转换为 LocalDateTime，时间部分设为午夜</span></span><br><span class="line">    <span class="comment">//        return localDate.atTime(LocalTime.MIDNIGHT);</span></span><br><span class="line">    <span class="keyword">return</span> localDate.atStartOfDay();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>请求：<code>http://localhost:8080/date1?localDateTime=2017-12-12 14:20:18</code></li>
</ul>
<p>返回：”2017-12-12T14:20:18”</p>
<ul>
<li>请求：<code>http://localhost:8080/date2?localDateTime=2017.12.12 14.20.18</code></li>
</ul>
<p>返回：”2017-12-12T14:20:18”</p>
<ul>
<li>请求：<code>http://localhost:8080/date3?localDate=2017/12/12</code></li>
</ul>
<p>返回：“2017-12-12T00:00:00”</p>
<h3 id="JSON数据"><a href="#JSON数据" class="headerlink" title="JSON数据"></a>JSON数据</h3><p>使用Post请求，放入请求体 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/show2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> user <span class="title function_">returnUser3</span><span class="params">(<span class="meta">@RequestBody</span> user user)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userService.findUser(user.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>json数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;小明&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>请求：<code>http://localhost:8080/request/show2</code></p>
<p>返回数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;小明&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="路径参数"><a href="#路径参数" class="headerlink" title="路径参数"></a>路径参数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;name&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> user <span class="title function_">returnUser</span><span class="params">(<span class="meta">@PathVariable</span> String name)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userService.findUser(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请求：<code>http://localhost:8080/request/小明</code></p>
<p>返回：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;小明&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="多个路径参数"><a href="#多个路径参数" class="headerlink" title="多个路径参数"></a>多个路径参数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;name&#125;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> user <span class="title function_">returnUser2</span><span class="params">(<span class="meta">@PathVariable</span> String name,<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userService.findIdUser(name,id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请求：<code>http://localhost:8080/request/小明/1</code></p>
<p>返回</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;小明&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="请求头"><a href="#请求头" class="headerlink" title="请求头"></a>请求头</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/headers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;user&gt; <span class="title function_">getHeaders</span><span class="params">(<span class="meta">@RequestHeader(&quot;id&quot;)</span> String id)</span> &#123;</span><br><span class="line">    System.out.println(userService.findID(id).toString());</span><br><span class="line">    <span class="keyword">return</span> userService.findID(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请求：<code>http://localhost:8080/headers</code></p>
<p>请求头中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> <span class="attr">http</span>:<span class="comment">//localhost:8080/headers</span></span><br><span class="line"><span class="number">200</span></span><br><span class="line"><span class="number">13</span> ms</span><br><span class="line"><span class="title class_">Network</span></span><br><span class="line"><span class="title class_">Request</span> <span class="title class_">Headers</span></span><br><span class="line"><span class="attr">id</span>: <span class="number">1</span></span><br><span class="line"><span class="title class_">Content</span>-<span class="title class_">Type</span>: application/json</span><br><span class="line"><span class="title class_">User</span>-<span class="title class_">Agent</span>: <span class="title class_">PostmanRuntime</span>/<span class="number">7.39</span><span class="number">.0</span></span><br><span class="line"><span class="title class_">Accept</span>: *<span class="comment">/*</span></span><br><span class="line"><span class="comment">Postman-Token: 1ad4d756-3577-4094-846a-caaed58ebc34</span></span><br><span class="line"><span class="comment">Host: localhost:8080</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate, br</span></span><br><span class="line"><span class="comment">Connection: keep-alive</span></span><br><span class="line"><span class="comment">Content-Length: 26</span></span><br></pre></td></tr></table></figure>
<p>响应数据:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;小明&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pass&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123456&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<h3 id="为传参进行正则验证"><a href="#为传参进行正则验证" class="headerlink" title="为传参进行正则验证"></a>为传参进行正则验证</h3><p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>参数前添加注解<code>@Pattern</code>,设置属性<code>regexp</code>进行正则表达式匹配</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/re&quot;)</span></span><br><span class="line"><span class="keyword">public</span> user <span class="title function_">re</span><span class="params">(<span class="meta">@Pattern(regexp = &quot;^\\d&#123;1,5&#125;$&quot;)</span> String id, String name)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userService.findIdUser(name, id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当请求参数不匹配时会抛出异常</p>
<p>请求<code>http://127.0.0.1:8080/re?id=112321323&amp;name=来了</code>，此时id长度大于五位数</p>
<p>报错类型是NoResourceFoundException.class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;timestamp&quot;</span>: <span class="string">&quot;2024-06-08T18:37:42.955+00:00&quot;</span>,</span><br><span class="line">    <span class="string">&quot;status&quot;</span>: <span class="number">400</span>,</span><br><span class="line">    <span class="string">&quot;error&quot;</span>: <span class="string">&quot;Bad Request&quot;</span>,</span><br><span class="line">    <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/re&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用全局异常进行处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(NoResourceFoundException.class)</span><span class="comment">//捕获异常</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">ex1</span><span class="params">(Exception ex)</span>&#123;</span><br><span class="line">    ex.printStackTrace();</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;异常！&quot;</span>);</span><br><span class="line">    log.info(ex.getMessage());</span><br><span class="line">    log.info(ex.toString());</span><br><span class="line">    log.info(String.valueOf(ex.getClass()));</span><br><span class="line">    <span class="keyword">return</span> StringUtils.hasLength(ex.getMessage())?ex.toString():<span class="string">&quot;操作失败&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得到的返回结果报错结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.web.servlet.resource.NoResourceFoundException<span class="punctuation">:</span> No static resource re.</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><h3 id="会话技术"><a href="#会话技术" class="headerlink" title="会话技术"></a>会话技术</h3><h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><p>存储在客户端的一个小文件,由web服务器发送并存储，有大小限制4kb，Http协议自带</p>
<p>不能跨域使用，即不能在不同的域名ip、端口、协议使用。</p>
<p>现在有<code>HttpOnly</code>和<code>Secure</code>提高安全性，前置禁止JavaScript访问，后者仅通过Https协议传输</p>
<p>Spring中使用:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/Cookie1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">c2</span><span class="params">(HttpServletResponse response)</span>&#123;</span><br><span class="line">    response.addCookie(<span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;Kirari&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/Cookie2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> HashMap&lt;String,Object&gt; <span class="title function_">c2</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span>&#123;</span><br><span class="line">    HashMap&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    jakarta.servlet.http.Cookie[] cookies = request.getCookies();</span><br><span class="line">    <span class="keyword">for</span> (Cookie cookie: cookies)&#123;</span><br><span class="line">        map.put(cookie.getName(),cookie.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>依次访问以下请求后</p>
<p><code>http://127.0.0.1:8080/Cookie1</code></p>
<p><code>http://127.0.0.1:8080/Cookie2</code></p>
<p>输出</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;JSESSIONID&quot;</span><span class="punctuation">:</span> <span class="string">&quot;49749D53DEADB60241F6711DE9A044FC&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Kirari&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>“JSESSIONID” 存在的原因是我先使用session，客户端把SessionID存储在了Cookie，所以会有一个”JSESSIONID”</p>
</blockquote>
<h4 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h4><p>存储在服务器，一个Session有一个特定的SessionID，用于识别不同的用户，SessionID对应的Session保存他们的信息，存储大小限制由服务器决定。</p>
<p>因为是由服务器存储，所以一般不会被篡改。</p>
<p>可以跨域实现访问请求，但是仅限在一个服务器上使用，如果部署在多个服务器实现负载均衡连接到其他的服务器的话会失败。</p>
<p>SessionID由Cookie或者URL传递。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/Session1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">s1</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">    session.setAttribute(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;kirari&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>  session.getId();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/Session2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> HashMap&lt;String,String&gt; <span class="title function_">s2</span><span class="params">(HttpSession session)</span> &#123;</span><br><span class="line">    session.setAttribute(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;kirari&quot;</span>);</span><br><span class="line"></span><br><span class="line">    HashMap&lt;String,String&gt; response = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    response.put(<span class="string">&quot;sessionId&quot;</span>, session.getId());</span><br><span class="line">    response.put(<span class="string">&quot;user&quot;</span>, session.getAttribute(<span class="string">&quot;user&quot;</span>).toString());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分别请求</p>
<p><code>http://127.0.0.1:8080/Session1</code></p>
<p><code>http://127.0.0.1:8080/Session2</code></p>
<p>结果是：</p>
<p><code>49749D53DEADB60241F6711DE9A044FC</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;sessionId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;49749D53DEADB60241F6711DE9A044FC&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="string">&quot;kirari&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="Token"><a href="#Token" class="headerlink" title="Token"></a>Token</h4><p>令牌，用于验证身份，保存在cookie或session中</p>
<p>认证（Authentication）和授权（Authorization）</p>
<p>服务器通过token验证用户身份，确定用户是本人登录</p>
<p>用户通过认证后，服务器给用户授权访问数据资源</p>
<h5 id="JWT（Json-Web-Token"><a href="#JWT（Json-Web-Token" class="headerlink" title="JWT（Json Web Token)"></a>JWT（Json Web Token)</h5><p>Token的一种形式</p>
<p>由三部分组成的字符串：头部.有效载荷.签名| Header.Payload.Signature</p>
<ul>
<li>Header(头部)：记录令牌类型、签名算法</li>
<li>Payload（有效载荷）：携带一些自定义信息，默认信息，例如用户信息等等。</li>
<li>Signature（签名），防止Token被篡改、验证</li>
</ul>
<p>如名字的Json所写，JWT的数据载体是Jsons数据</p>
<p>例如：</p>
<p><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiS2lyYXJpIiwiaWF0Ijoia2lrbzI1NjgiLCJlbWlsIjoiMTI0NDExODQ0NUBxcS5jb20ifQ.1OUNtc4D_SKyDJp9NX2qpBNUPEvHsQT9PfY7C7cxmoc</code></p>
<p>是一串JWT字符串，包含三部分这三部分的内容是</p>
<p>HEADER:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>PAYLOAD:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Kirari&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span> <span class="number">1683124800</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span> <span class="number">1714761600</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;emil&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1244118445@qq.com&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Payload 用来存放实际需要传递的数据，JWT 规定的7个官方字段，供选用：</p>
<ol>
<li><ul>
<li>iss (Issuer)：签发者</li>
<li>sub (Subject)：主题</li>
<li>aud (Audience)：接收者</li>
<li>exp (Expiration time)：过期时间  || 格式 为时间戳</li>
<li>nbf (Not Before)：生效时间</li>
<li>iat (Issued At)：签发时间</li>
<li>jti (JWT ID)：编号</li>
</ul>
</li>
</ol>
<p>SIGNATURE:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">  base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> +</span><br><span class="line">  base64UrlEncode(payload)<span class="punctuation">,</span></span><br><span class="line">	hihihi</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>其中JWT编码中的a.b.c：a,b仅仅是由 base64编码转化，并不具备加密性，可以被解析。c，也就是签名部分，由a+b的base64编码加上一个自己定义的字符串为签名并使用特定的编码格式加密。</p>
<blockquote>
<p>base64 是 <code>A~Z</code>、<code>a~z</code>、<code>0~9</code>、<code>+  /</code>诸如此类64个可打印字符</p>
</blockquote>
<p>修改/删除/添加任何一个字符都会导致jwt编码验证失效，给定的签名不一致也会导致签名校验失败，并且jwt可以设置失效时间，一定程度上保障了安全性。</p>
<p>使用：</p>
<p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>特别的依赖： <code>NoClassDefFoundError: javax/xml/bind/DatatypeConverter</code> 错误</p>
<p>使用 JWT 库时，找不到 <code>javax.xml.bind.DatatypeConverter</code> 类引起的。这个类在 Java 9 及以后版本中已经被移除。</p>
<p>添加依赖解决</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.jaxb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-runtime<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@GetMapping(&quot;/JWT&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getJWT</span><span class="params">()</span>&#123;</span><br><span class="line">        String jwt;</span><br><span class="line">        HashMap&lt;String,Object&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        data.put(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;Kirari&quot;</span>);</span><br><span class="line">        data.put(<span class="string">&quot;emil&quot;</span>,<span class="string">&quot;1244118445@qq.com&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//      使用生成的HMAC-SHA</span></span><br><span class="line"><span class="comment">//        Key key = Keys.secretKeyFor(SignatureAlgorithm.HS256);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        jwt= Jwts.builder()</span></span><br><span class="line"><span class="comment">//                .setClaims(data)//设置有效载荷</span></span><br><span class="line"><span class="comment">//                .signWith(SignatureAlgorithm.HS256,key)//签名算法</span></span><br><span class="line"><span class="comment">//                .setExpiration(new Date(System.currentTimeMillis()+24*60*60*7))//设置有效期</span></span><br><span class="line"><span class="comment">//                .compact();</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">         使用key需要多添加的依赖</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;jjwt-api&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;0.11.2&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;jjwt-impl&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;0.11.2&lt;/version&gt;</span></span><br><span class="line"><span class="comment">            &lt;scope&gt;runtime&lt;/scope&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;jjwt-jackson&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;0.11.2&lt;/version&gt;</span></span><br><span class="line"><span class="comment">            &lt;scope&gt;runtime&lt;/scope&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">        jwt= Jwts.builder()</span><br><span class="line">                .setSubject(<span class="string">&quot;主题&quot;</span>)</span><br><span class="line">                .setIssuer(<span class="string">&quot;发布者&quot;</span>)</span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>())<span class="comment">//发行时间</span></span><br><span class="line">                .setClaims(data)<span class="comment">//设置有效载荷</span></span><br><span class="line">                .signWith(SignatureAlgorithm.HS256,<span class="string">&quot;kiko2568&quot;</span>)<span class="comment">//签名算法</span></span><br><span class="line">                .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis()+<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>*<span class="number">7</span>*<span class="number">1000</span>))<span class="comment">//设置有效期 单位是毫秒</span></span><br><span class="line">                .compact();</span><br><span class="line">        <span class="keyword">return</span> jwt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/parseJWT&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Claims <span class="title function_">parseJwt</span><span class="params">(String jwt)</span>&#123;</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> Jwts.parser()</span><br><span class="line">                .setSigningKey(<span class="string">&quot;kiko2568&quot;</span>)</span><br><span class="line">                .parseClaimsJws(jwt)</span><br><span class="line">                .getBody();</span><br><span class="line">        <span class="keyword">return</span> claims;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//另一种解析方法</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SECRET_KEY</span> <span class="operator">=</span> <span class="string">&quot;kiko2568&quot;</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Claims <span class="title function_">parseToken</span><span class="params">(String jwt)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (jwt == <span class="literal">null</span> || jwt.trim().isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;JWT String argument cannot be null or empty.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//转码</span></span><br><span class="line">        <span class="type">byte</span>[] apiKeySecretBytes = DatatypeConverter.parseBase64Binary(SECRET_KEY);</span><br><span class="line">        <span class="type">Key</span> <span class="variable">signingKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(apiKeySecretBytes, SignatureAlgorithm.HS256.getJcaName());</span><br><span class="line"></span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> Jwts.parserBuilder()</span><br><span class="line">                .setSigningKey(signingKey)</span><br><span class="line">                .build()</span><br><span class="line">                .parseClaimsJws(jwt)</span><br><span class="line">                .getBody();</span><br><span class="line">        <span class="keyword">return</span> claims;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>请求：</p>
<p><code>http://127.0.0.1:8080/JWT</code></p>
<p>返回：</p>
<p><code>eyJhbGciOiJIUzI1NiJ9.eyJlbWlsIjoiMTI0NDExODQ0NUBxcS5jb20iLCJleHAiOjE3MTc2NjcwOTEsInVzZXIiOiJLaXJhcmkifQ.WysLyZkwdJdRlZafwTT61geaHbsqvpXY3240vYggBm4</code></p>
<p>请求：</p>
<p><code>http://127.0.0.1:8080/parseJWT?jwt=eyJhbGciOiJIUzI1NiJ9.eyJlbWlsIjoiMTI0NDExODQ0NUBxcS5jb20iLCJleHAiOjE3MTc2NjcwOTEsInVzZXIiOiJLaXJhcmkifQ.WysLyZkwdJdRlZafwTT61geaHbsqvpXY3240vYggBm4</code></p>
<p>返回：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;emil&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1244118445@qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span> <span class="number">1717667091</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Kirari&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>当请求的jwt令牌不一样时，或者密钥签名不一样时，会造成500错误</p>
<blockquote>
<p>推荐文章：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40598838/article/details/108575508">微服务下使用jjwt生成token签名signwith带来的问题_jwt signwith-CSDN博客</a></p>
</blockquote>
<hr>
<h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h2><p><code>@ResponseBody</code></p>
<ul>
<li>方法注解、类注解</li>
<li>位置Controlller方法、类上</li>
<li>将返回值直接响应，如果是对象、集合，自动转化为json格式</li>
<li><code>@RestController</code>=<code>@ResponseBody</code>+<code>@Controller</code></li>
</ul>
<hr>
<p>统一响应结果:返回给前端时给前端一个统一的格式</p>
<p>Result(code,message,data)    类</p>
<p>其中：code为状态码，200成功，404资源找不到之类</p>
<p>message，传递消息，传递成功失败这类</p>
<p>data，响应的数据</p>
<hr>
<h2 id="拦截器和过滤器"><a href="#拦截器和过滤器" class="headerlink" title="拦截器和过滤器"></a>拦截器和过滤器</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    participant Client</span><br><span class="line">    participant DispatcherServlet</span><br><span class="line">    participant HandlerInterceptor</span><br><span class="line">    participant Filter</span><br><span class="line">    Client -&gt;&gt; DispatcherServlet: 发起HTTP请求</span><br><span class="line">    DispatcherServlet -&gt;&gt; HandlerInterceptor: 执行拦截器预处理</span><br><span class="line">    HandlerInterceptor -&gt;&gt; Filter: 执行过滤器链的第一个过滤器</span><br><span class="line">    Filter -&gt;&gt; Filter: 执行过滤器链的其他过滤器</span><br><span class="line">    Filter --&gt;&gt; HandlerInterceptor: 过滤器链结束，返回控制器处理</span><br><span class="line">    HandlerInterceptor --&gt;&gt; DispatcherServlet: 拦截器预处理结束，继续处理请求</span><br><span class="line">    DispatcherServlet -&gt;&gt; DispatcherServlet: 执行控制器处理</span><br><span class="line">    DispatcherServlet --&gt;&gt; Filter: 返回控制器处理结果</span><br><span class="line">    Filter --&gt;&gt; Client: 返回HTTP响应</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><blockquote>
<p>引入的接口是<code>import jakarta.servlet.*;</code>下的Filter</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置拦截的请求</span></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//引入的Filter是   import jakarta.servlet.*;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filterConfig</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.init(filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拦截到请求就调用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> servletRequest</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> servletResponse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filterChain</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//执行下面一句代码是放行操作，如果不执行就不会放行</span></span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 销毁</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 和初始化一样只调用一次并且默认实现</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// ↓ 开启spring对javaweb servlet  过滤器的支持</span></span><br><span class="line"><span class="meta">@ServletComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DashijianApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DashijianApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>拦截规则</p>
<p><code>@WebFilter(urlPatterns = &quot;/*&quot;)</code></p>
<ul>
<li><p>/</p>
<p>所有请求，同<code>/*</code></p>
</li>
<li><p>/main</p>
<p>仅<code>&quot;/main&quot;</code>请求可以被拦截</p>
</li>
<li><p>/main/</p>
<p>只有<code>/main/</code>请求拦截</p>
</li>
<li><p>/main/*</p>
<p>/main、/main/、/main/ads、/main/asda/saddw/dasd，均能拦截</p>
</li>
</ul>
<p>过滤器链顺序</p>
<p>多个过滤器连成过滤器链的时候，以栈的形式，按照字典序顺序先进后出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    participant Client</span><br><span class="line">    participant Afilter</span><br><span class="line">    participant Bfilter</span><br><span class="line">    participant 资源</span><br><span class="line">    Client-&gt;&gt;Afilter: 请求拦截</span><br><span class="line">    Afilter-&gt;&gt;Bfilter: A放行/请求被B拦截</span><br><span class="line">    Bfilter-&gt;&gt;资源: 放行</span><br><span class="line">    资源-&gt;&gt;Bfilter: 响应</span><br><span class="line">    Bfilter-&gt;&gt;Afilter: 响应</span><br><span class="line">    Afilter-&gt;&gt;Client: 响应</span><br><span class="line">  </span><br></pre></td></tr></table></figure>
<p>A拦截器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    log.info(<span class="string">&quot;A拦截前&quot;</span>);</span><br><span class="line">    filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    log.info(<span class="string">&quot;A拦截后&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>B拦截器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    log.info(<span class="string">&quot;B拦截前&quot;</span>);</span><br><span class="line">    filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    log.info(<span class="string">&quot;B拦截后&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2024-06-06T22:03:44.124+08:00  INFO 31996 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.Filter.AFilter      : A拦截前</span><br><span class="line">2024-06-06T22:03:44.124+08:00  INFO 31996 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.Filter.BFilter      : B拦截前</span><br><span class="line">2024-06-06T22:03:44.145+08:00  INFO 31996 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.Filter.BFilter      : B拦截后</span><br><span class="line">2024-06-06T22:03:44.146+08:00  INFO 31996 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.Filter.AFilter      : A拦截后</span><br></pre></td></tr></table></figure>
<h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 资源方法前运行      return true 放行 false拦截</span></span><br><span class="line"><span class="comment">     * 如果被拦截器拦截，下面的其他俩个方法不会执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="comment">//        return HandlerInterceptor.super.preHandle(request, response, handler);</span></span><br><span class="line">       log.info(<span class="string">&quot;111111111&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 资源方法运行后运行,没有资源返回不会执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> modelAndView</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="comment">//        HandlerInterceptor.super.postHandle(request, response, handler, modelAndView);</span></span><br><span class="line">        log.info(<span class="string">&quot;2222222222&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 视图渲染后运行，最后运行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="comment">//        HandlerInterceptor.super.afterCompletion(request, response, handler, ex);</span></span><br><span class="line">        log.info(<span class="string">&quot;3333333333&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>WebConfig类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span>  <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DemoInterceptor demoInterceptor;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(demoInterceptor)</span><br><span class="line">            .addPathPatterns(<span class="string">&quot;/**ude**&quot;</span>)<span class="comment">//配置拦截路径</span></span><br><span class="line">            .excludePathPatterns();<span class="comment">//配置排除路径</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>preHandle：请求到达接口之前执行，afterCompletion：请求（接口）结束后执行</p>
</blockquote>
<h4 id="拦截规则"><a href="#拦截规则" class="headerlink" title="拦截规则"></a>拦截规则</h4><ul>
<li><p><code>/</code></p>
<p>只拦截<code>localhost/</code>的请求</p>
</li>
<li><p><code>/*</code></p>
<p>拦截所有<code>localhost/dddd</code>请求，不包括<code>localhost/dddd/</code></p>
</li>
<li><p><code>/**</code></p>
<p>所有请求</p>
</li>
<li><p><code>/admin/</code></p>
<p>只有<code>/admin/</code></p>
</li>
<li><p><code>/admin/*</code></p>
<p>任意<code>/admin/xxx</code></p>
</li>
<li><p><code>/admin/**</code></p>
<p>任意<code>/admin</code>开头的路径，包括<code>/admin</code>、<code>/admin/</code></p>
</li>
<li><p><code>/admin**</code></p>
<p>任意<code>/admin</code>开头的路径，包括<code>/admin</code>，甚至是<code>/adminhello</code>,不包括<code>/admin/</code>等等，只是admin开头的当前路径</p>
</li>
<li><p><code>/admin*</code></p>
<p>同上</p>
</li>
<li><p><code>/**admin</code>、<code>/*admin</code></p>
<p>结尾是admin就被拦截</p>
</li>
<li><p><code>/*admin*</code>、<code>/**admin*</code>、<code>/*admin**</code>、<code>/**admin**</code></p>
<p>中间是admin被拦截</p>
</li>
</ul>
<p>核心👆</p>
<hr>
<p>衍变👇</p>
<ul>
<li><p><code>/admin**/</code></p>
<p>只有<code>/adminxxxxx/</code></p>
</li>
<li><p><code>/admin*/</code></p>
<p>同上</p>
</li>
<li><p><code>/admin*/*</code></p>
<p>只是<code>/adminxxxxxxx/xxxx</code>一级目录</p>
</li>
<li><p><code>/admin*/**</code></p>
<p>任意<code>/adminxxxxxxx/**</code>子目录</p>
</li>
<li><p><code>/admin**/*</code></p>
<p>同<code>/admin*/*</code></p>
</li>
<li><p><code>/admin**/**</code></p>
<p>同<code>/admin**/**</code></p>
</li>
<li><p><code>/*/admin</code>、<code>/**/admin</code></p>
<p>单级目录下的admin，任意一级目录下的admin</p>
</li>
<li><p><code>/**/admin/**</code></p>
<p>中间目录有admin就被拦截</p>
</li>
</ul>
<hr>
<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>异常处理代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span><span class="comment">//</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span><span class="comment">//捕获所有异常</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.NOT_FOUND)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">ex</span><span class="params">(Exception ex)</span>&#123;</span><br><span class="line">        ex.printStackTrace();</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;异常！&quot;</span>);</span><br><span class="line">        log.info(ex.getMessage());</span><br><span class="line">        log.info(ex.toString());</span><br><span class="line">        log.info(String.valueOf(ex.getClass()));</span><br><span class="line">        <span class="keyword">return</span> ex.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>@RestControllerAdvice</code>=<code>@ResponseBody</code>+<code>@ControllerAdvice</code></li>
</ul>
<p><code>@ResponseBody</code>是转化返回数据为String或Json数据</p>
<p><code>@ControllerAdvice</code>标记这个类为全局异常处理类</p>
<ul>
<li><p><code>@ExceptionHandler()</code>甚至接收异常的数据</p>
<ul>
<li><code>Exception.class</code>表示全部异常都接收</li>
</ul>
</li>
<li><p><code>@ResponseStatus()</code>服务器返回的状态码</p>
<ul>
<li><code>@ResponseStatus(HttpStatus.NOT_FOUND)</code>返回404</li>
<li><code>@ResponseStatus(HttpStatus.BAD_REQUEST)</code>返回400</li>
<li><code>@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</code>返回内部服务器错误500</li>
</ul>
</li>
</ul>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>在你想管理事务的方法、类、接口上加上<code>import org.springframework.transaction.annotation.Transactional;</code>的 <code>@Transactional</code>，SpringBoot就会自动帮你开启事务管理了</p>
<p>在方法上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(user user)</span> &#123;</span><br><span class="line">    userMapper.update(user);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    userMapper.update(user);</span><br><span class="line">    <span class="keyword">return</span> userMapper.update(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问该Sevice后</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Creating a new SqlSession</span><br><span class="line">Registering transaction synchronization <span class="keyword">for</span> SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3440b721]</span><br><span class="line">JDBC Connection [HikariProxyConnection@1293827318 wrapping com.mysql.cj.jdbc.ConnectionImpl@32ab408e] will be managed by Spring</span><br><span class="line">==&gt;  Preparing: update user <span class="built_in">set</span> name=?,pass=? <span class="built_in">where</span> <span class="built_in">id</span>= ?</span><br><span class="line">==&gt; Parameters: 来了(String), 123456(String), 7(Integer)</span><br><span class="line">&lt;==    Updates: 1</span><br><span class="line">Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3440b721]</span><br><span class="line">Transaction synchronization deregistering SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3440b721]</span><br><span class="line">Transaction synchronization closing SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3440b721]</span><br><span class="line">java.lang.ArithmeticException: / by zero</span><br><span class="line">	at com.kirari.dashijian.service.UserService.update(UserService.java:56)</span><br><span class="line">	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)</span><br><span class="line">	at java.base/java.lang.reflect.Method.invoke(Method.java:577)</span><br></pre></td></tr></table></figure>
<p>查看数据库并没有实现数据更新</p>
<p>在类上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentService</span> &#123;</span><br></pre></td></tr></table></figure>
<p>类的所有方法都开启事务管理</p>
<h4 id="事务处理异常范围"><a href="#事务处理异常范围" class="headerlink" title="事务处理异常范围"></a>事务处理异常范围</h4><p>事务异常默认只实现RuntimeException，当其他异常发生时，并不会回滚异常</p>
<p>通过设置rollbackFor属性设置处理的异常范围</p>
<p>如下是处理全部异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br></pre></td></tr></table></figure>
<h4 id="嵌套事务-传播行为"><a href="#嵌套事务-传播行为" class="headerlink" title="嵌套事务-传播行为"></a>嵌套事务-传播行为</h4><p>指一个事务中的方法中包含另外一个有事务的方法，这个被包含的事务该如何执行</p>
<p>设置<code>propagation</code>的属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional()</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">A</span><span class="params">()</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    B();    </span><br><span class="line">   	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class,propagation = Propagation.REQUIRED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">B</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p> 此时B的propagation属性值觉得了B在A中执行的事务管理级别</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>属性值</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>REQUIRED</td>
<td>（默认）A有事务就加入，没有事务就创建新事务</td>
</tr>
<tr>
<td>REQUIRES_NEW</td>
<td>无论A有没有事务都创建新事务</td>
</tr>
<tr>
<td>SUPPORTS</td>
<td>A有事务就加入，无事务就在无事务的情况下运行，不创建新事务</td>
</tr>
<tr>
<td>NOT_SUPPORTED</td>
<td>不支持事务，在无事务状态下运行，<br />如果A有事务，A的事务就暂停挂起，运行完B方法再进行A的方法执行以及事务管理</td>
</tr>
<tr>
<td>MANDATORY</td>
<td>A必须有 事务否则异常</td>
</tr>
<tr>
<td>NEVER</td>
<td>A必须无事务，否则异常</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>属性为REQUIRED时，A或者B发生异常了，整体回滚，因为他们是一个事务</li>
<li>属性为REQUIRES_NEW时，A或B发生异常了，互不影响，只回滚发生异常的方法。</li>
</ul>
<hr>
<h4 id="查看事务日志"><a href="#查看事务日志" class="headerlink" title="查看事务日志"></a>查看事务日志</h4><p>配置类</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">org.springframework.jdbc.support.JdbcTransactionManager:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>
<p>一般的，日志会有几个级别的输出，默认info</p>
<ul>
<li><p><strong>TRACE</strong>：</p>
<p>最详细的日志级别。记录非常细粒度的信息，主要用于开发和调试阶段</p>
<p>用于记录非常详细的系统信息。</p>
<p>示例：记录每个方法的进入和退出，详细的变量状态等。</p>
</li>
<li><p><strong>DEBUG</strong>：</p>
<p>用于调试信息。包含较详细的调试信息，便于开发人员了解应用的内部状态。</p>
<p>用于调试信息，帮助开发人员追踪应用的执行过程。</p>
<p>示例：记录SQL查询语句、请求和响应的详细信息等。</p>
</li>
<li><p><strong>INFO</strong>：</p>
<p>用于信息性消息。一般用于记录应用的正常运行状态，重要的事件和信息。</p>
<p>用于记录应用的主要事件和操作。</p>
<p>示例：应用启动和关闭、重要配置的加载、重要任务的完成等。</p>
</li>
<li><p><strong>WARN</strong>：</p>
<p>用于警告信息。表示潜在的问题，系统可以继续运行，但需要注意。</p>
<p>用于记录潜在的问题。</p>
<p>示例：配置项缺失但有默认值、不推荐的API使用等。</p>
</li>
<li><p><strong>ERROR</strong>：</p>
<p>用于错误信息。表示发生了错误，可能导致某些功能不能正常工作。</p>
<p>用于记录错误事件。</p>
<p>示例：捕获的异常、数据库连接失败等。</p>
</li>
<li><p><strong>FATAL</strong>：</p>
<p>表示非常严重的错误，可能导致应用程序终止。</p>
<p>用于记录导致系统崩溃的严重错误。</p>
<p>示例：应用程序无法启动、关键服务无法初始化等。</p>
</li>
</ul>
<blockquote>
<p>关于SpringBoot无需再设置<code>@EnableTransactionManagement</code>,</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40794973/article/details/106597952">Spring Boot中不需要加 @EnableTransactionManagement 来开启事务_@enabletransactionmanagement(proxytargetclass = tr-CSDN博客</a></p>
</blockquote>
<p>自动配置类中的事务配置类<code>TransactionAutoConfiguration.java</code>中有这个一段代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnBean(&#123;TransactionManager.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(&#123;AbstractTransactionManagementConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EnableTransactionManagementConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EnableTransactionManagementConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">        proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="meta">@EnableTransactionManagement(</span></span><br><span class="line"><span class="meta">        proxyTargetClass = true</span></span><br><span class="line"><span class="meta">    )</span></span><br></pre></td></tr></table></figure>
<p>暂时看不懂，只明白大概是说存在这个类<code>TransactionManager.class</code>，且不存在<code>AbstractTransactionManagementConfiguration.class</code>这类，才会创建和加载这个配置类。</p>
<p>大概是存在<code>@Transaction</code>，且没有自定义<code>AbstractTransactionManagementConfiguration</code>继承这个抽象类的时候自动配置。</p>
<h2 id="AOC-面向切片编程"><a href="#AOC-面向切片编程" class="headerlink" title="AOC-面向切片编程"></a>AOC-面向切片编程</h2><p>面向特定的方法进行编程，对特定的一个或多个原来方法的增强、修改等等</p>
<p>例子：</p>
<p>引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>SpringBoot事务管理的原理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//标记AOP</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">demoAop</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//切入表达式</span></span><br><span class="line">    <span class="comment">//匹配的路径，代表哪个路径下的类方法执行被提取到这里来</span></span><br><span class="line">    <span class="comment">//代表下面的方法执行的时候会进行下面的操作</span></span><br><span class="line">        <span class="meta">@Around(&quot;execution(* com.kirari.dashijian.service.UserService.update())&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">Transaction</span><span class="params">(ProceedingJoinPoint joinPoint)</span>&#123;</span><br><span class="line">      log.info(<span class="string">&quot;开启事务&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">//执行原来的方法</span></span><br><span class="line">             result = joinPoint.proceed();</span><br><span class="line">      &#125;<span class="keyword">catch</span> (Exception exception)&#123;</span><br><span class="line">          log.info(<span class="string">&quot;出现错误,事务回滚&quot;</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">      &#125;</span><br><span class="line">      log.info(<span class="string">&quot;事务提交&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为所有方法添加一个 查看执行时间的功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="comment">//给IOC容器管理</span></span><br><span class="line"><span class="meta">@Aspect</span><span class="comment">//标记为AOP</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeAop</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.kirari.dashijian.*.*(..))&quot;)</span><span class="comment">//切入点表达式</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">time</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();<span class="comment">//原方法</span></span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;耗时&quot;</span>+(end-begin));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="AOC的核心概念"><a href="#AOC的核心概念" class="headerlink" title="AOC的核心概念"></a>AOC的核心概念</h3><ul>
<li>连接点：JoinPoint,被AOP控制的方法，即原方法</li>
<li>通知：Advice，可重复的逻辑，即AOP声明实现的 方法</li>
<li>切入点：PointCut，切面表达式匹配成功的方法</li>
<li>切面：Aspect，通知+切入点</li>
<li>目标对象：Target，原来方法所属的对象/类</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com//blogimage-20240607162510136.webp" alt="AOP类"></p>
<p>其中@Aspect标记为切面类</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com//blogimage-20240607162711982.webp" alt="原方法"></p>
<h3 id="AOP实现原理"><a href="#AOP实现原理" class="headerlink" title="AOP实现原理"></a>AOP实现原理</h3><p>通过动态代理技术，使用代理对象实现AOP操作</p>
<p>假如我们有一个AOP类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeAop</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.kirari.dashijian.service.UserService.update())&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">time</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;耗时&quot;</span>+(end-begin));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一个原方法类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(user user)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> userMapper.update(user);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在执行<code>UserService.updete(user)</code>方法的时候，底层生成一个代理对象，并且实现了原方法+AOP方法，即通知：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceProxy</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(user user)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">line</span> <span class="operator">=</span> userMapper.update(user);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;耗时&quot;</span>+(end-begin));</span><br><span class="line"></span><br><span class="line"> 	   <span class="keyword">return</span> line;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时在调用这方法的控制层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">( user user)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.update(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过<code>@Autowired</code>自动注入的UserService类就不是原来的目标对象了，而是代理对象UserServiceProxy，实现的方法此时就是修改后的方法。</p>
<h3 id="通知"><a href="#通知" class="headerlink" title="通知"></a>通知</h3><h4 id="通知-Advice-类型"><a href="#通知-Advice-类型" class="headerlink" title="通知(Advice)类型"></a>通知(Advice)类型</h4><ul>
<li><strong>前置通知（Before ）</strong>：在目标方法执行之前运行。</li>
<li><strong>后置通知（After ）</strong>：在目标方法执行之后运行，无论方法是否成功执行。</li>
<li><strong>返回通知（After Returning ）</strong>：在目标方法成功执行并返回结果之后运行。</li>
<li><strong>异常通知（After Throwing ）</strong>：在目标方法抛出异常之后运行。</li>
<li><strong>环绕通知（Around ）</strong>：包围目标方法的执行，可以在方法执行前后自定义行为。</li>
</ul>
<p>测试顺序:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderAop</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;execution(* com.kirari.dashijian.service.UserService.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;afterReturning&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;execution(* com.kirari.dashijian.service.UserService.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;afterThrowing&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.kirari.dashijian.service.UserService.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;after&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.kirari.dashijian.service.UserService.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;before&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.kirari.dashijian.service.UserService.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">Around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;环绕前&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;环绕后&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正常执行时顺序：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">2024-06-07T18:56:01.093+08:00  INFO 12312 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : 环绕前</span><br><span class="line">2024-06-07T18:56:01.093+08:00  INFO 12312 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : before</span><br><span class="line">Creating a new SqlSession</span><br><span class="line">Registering transaction synchronization <span class="keyword">for</span> SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3e70fe17]</span><br><span class="line">JDBC Connection [HikariProxyConnection@716877553 wrapping com.mysql.cj.jdbc.ConnectionImpl@7cfb8e98] will be managed by Spring</span><br><span class="line">==&gt;  Preparing: update user <span class="built_in">set</span> name=?,pass=? <span class="built_in">where</span> <span class="built_in">id</span>= ?</span><br><span class="line">==&gt; Parameters: 啦啦(String), 123456(String), 7(Integer)</span><br><span class="line">&lt;==    Updates: 1</span><br><span class="line">Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3e70fe17]</span><br><span class="line">2024-06-07T18:56:01.144+08:00  INFO 12312 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : afterReturning</span><br><span class="line">2024-06-07T18:56:01.145+08:00  INFO 12312 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : after</span><br><span class="line">2024-06-07T18:56:01.145+08:00  INFO 12312 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : 环绕后</span><br></pre></td></tr></table></figure>
<p>出现异常时顺序：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2024-06-07T18:59:34.678+08:00  INFO 25016 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : 环绕前</span><br><span class="line">2024-06-07T18:59:34.678+08:00  INFO 25016 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : before</span><br><span class="line">Creating a new SqlSession</span><br><span class="line">Registering transaction synchronization <span class="keyword">for</span> SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6f3b557e]</span><br><span class="line">JDBC Connection [HikariProxyConnection@254878470 wrapping com.mysql.cj.jdbc.ConnectionImpl@3e6748ae] will be managed by Spring</span><br><span class="line">==&gt;  Preparing: update user <span class="built_in">set</span> name=?,pass=? <span class="built_in">where</span> <span class="built_in">id</span>= ?</span><br><span class="line">==&gt; Parameters: 啦啦(String), 123456(String), 7(Integer)</span><br><span class="line">&lt;==    Updates: 1</span><br><span class="line">Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6f3b557e]</span><br><span class="line">2024-06-07T18:59:34.710+08:00  INFO 25016 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : afterThrowing</span><br><span class="line">2024-06-07T18:59:34.710+08:00  INFO 25016 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : after</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<p>返回通知在目标方法成功执行并返回结果之后运行，可以访问返回值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAfterReturningAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(pointcut = &quot;execution(* com.example.service.*.*(..))&quot;, returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturningAdvice</span><span class="params">(Object result)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;After returning advice executed, result: &quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>异常通知在目标方法抛出异常之后运行，可以处理异常：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAfterThrowingAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(pointcut = &quot;execution(* com.example.service.*.*(..))&quot;, throwing = &quot;exception&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowingAdvice</span><span class="params">(Exception exception)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;After throwing advice executed, exception: &quot;</span> + exception.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="多个通知时执行顺序"><a href="#多个通知时执行顺序" class="headerlink" title="多个通知时执行顺序"></a>多个通知时执行顺序</h4><h5 id="默认顺序"><a href="#默认顺序" class="headerlink" title="默认顺序"></a>默认顺序</h5><p><strong>默认按照字典序排序，按照栈的模式先进后出</strong></p>
<p>字典序前的先执行</p>
<hr>
<p>测试：我定义了、<code>AAAop</code>、<code>Order</code>、<code>ZZzAop</code>三个实现了不同通知类型但是切入点都一样的方法</p>
<p>具体如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderAop</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;execution(* com.kirari.dashijian.service.UserService.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order:afterReturning&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;execution(* com.kirari.dashijian.service.UserService.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order:afterThrowing&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.kirari.dashijian.service.UserService.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order:after&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.kirari.dashijian.service.UserService.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order:before&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.kirari.dashijian.service.UserService.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">Around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;Order:环绕前&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;Order:环绕后&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>AAA</code> 和<code>ZZZ</code>仅仅是修改参数，不贴代码出来了</p>
<p>这是结果:</p>
<p>正常运行时：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">2024-06-07T19:11:55.840+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.AAAop           : AAAop:环绕前</span><br><span class="line">2024-06-07T19:11:55.840+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.AAAop           : AAAop:before</span><br><span class="line">2024-06-07T19:11:55.840+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:环绕前</span><br><span class="line">2024-06-07T19:11:55.840+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:before</span><br><span class="line">2024-06-07T19:11:55.840+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:环绕前</span><br><span class="line">2024-06-07T19:11:55.840+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:before</span><br><span class="line">Creating a new SqlSession</span><br><span class="line">Registering transaction synchronization <span class="keyword">for</span> SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@fb571f]</span><br><span class="line">JDBC Connection [HikariProxyConnection@2005302264 wrapping com.mysql.cj.jdbc.ConnectionImpl@44fd7ba4] will be managed by Spring</span><br><span class="line">==&gt;  Preparing: update user <span class="built_in">set</span> name=?,pass=? <span class="built_in">where</span> <span class="built_in">id</span>= ?</span><br><span class="line">==&gt; Parameters: 来了(String), 123456(String), 7(Integer)</span><br><span class="line">&lt;==    Updates: 1</span><br><span class="line">Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@fb571f]</span><br><span class="line">2024-06-07T19:11:55.877+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:afterReturning</span><br><span class="line">2024-06-07T19:11:55.878+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:after</span><br><span class="line">2024-06-07T19:11:55.878+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:环绕后</span><br><span class="line">2024-06-07T19:11:55.878+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:afterReturning</span><br><span class="line">2024-06-07T19:11:55.878+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:after</span><br><span class="line">2024-06-07T19:11:55.878+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:环绕后</span><br><span class="line">2024-06-07T19:11:55.878+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.AAAop           : AAAop:afterReturning</span><br><span class="line">2024-06-07T19:11:55.878+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.AAAop           : AAAop:after</span><br><span class="line">2024-06-07T19:11:55.878+08:00  INFO 25660 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.AAAop           : AAAop:环绕后</span><br></pre></td></tr></table></figure>
<p>异常时：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">2024-06-07T19:10:21.132+08:00  INFO 18560 --- [dashijian] [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization <span class="keyword">in</span> 1 ms</span><br><span class="line">2024-06-07T19:10:21.180+08:00  INFO 18560 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.AAAop           : AAAop:环绕前</span><br><span class="line">2024-06-07T19:10:21.181+08:00  INFO 18560 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.AAAop           : AAAop:before</span><br><span class="line">2024-06-07T19:10:21.181+08:00  INFO 18560 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:环绕前</span><br><span class="line">2024-06-07T19:10:21.181+08:00  INFO 18560 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:before</span><br><span class="line">2024-06-07T19:10:21.181+08:00  INFO 18560 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:环绕前</span><br><span class="line">2024-06-07T19:10:21.181+08:00  INFO 18560 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:before</span><br><span class="line">Creating a new SqlSession</span><br><span class="line">Registering transaction synchronization <span class="keyword">for</span> SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@67fd0c2]</span><br><span class="line">JDBC Connection [HikariProxyConnection@1085675753 wrapping com.mysql.cj.jdbc.ConnectionImpl@69d103f0] will be managed by Spring</span><br><span class="line">==&gt;  Preparing: update user <span class="built_in">set</span> name=?,pass=? <span class="built_in">where</span> <span class="built_in">id</span>= ?</span><br><span class="line">==&gt; Parameters: 来了(String), 123456(String), 7(Integer)</span><br><span class="line">&lt;==    Updates: 1</span><br><span class="line">Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@67fd0c2]</span><br><span class="line">2024-06-07T19:10:21.221+08:00  INFO 18560 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:afterThrowing</span><br><span class="line">2024-06-07T19:10:21.221+08:00  INFO 18560 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:after</span><br><span class="line">2024-06-07T19:10:21.221+08:00  INFO 18560 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:afterThrowing</span><br><span class="line">2024-06-07T19:10:21.221+08:00  INFO 18560 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:after</span><br><span class="line">2024-06-07T19:10:21.221+08:00  INFO 18560 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.AAAop           : AAAop:afterThrowing</span><br><span class="line">2024-06-07T19:10:21.221+08:00  INFO 18560 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.AAAop           : AAAop:after</span><br></pre></td></tr></table></figure>
<p>与理论一致</p>
<hr>
<h5 id="自定义顺序"><a href="#自定义顺序" class="headerlink" title="自定义顺序"></a>自定义顺序</h5><p>使用<code>@Order(数字)</code>进行自定义顺序</p>
<p><strong>数字越小优先级越高</strong></p>
<hr>
<p>分别对三个类进行自定义排序</p>
<ul>
<li><p>```java<br>@Order(1)<br>public class OrderAop{}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  @Order(2)</span><br><span class="line">  public class ZZzAop&#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>```java<br>@Order(3)<br>public class AAAop{}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">测试：</span><br><span class="line"></span><br><span class="line">正常运行：</span><br><span class="line"></span><br><span class="line">```sh</span><br><span class="line">2024-06-07T19:21:07.065+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.OrderAop        : Order:环绕前</span><br><span class="line">2024-06-07T19:21:07.065+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.OrderAop        : Order:before</span><br><span class="line">2024-06-07T19:21:07.065+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:环绕前</span><br><span class="line">2024-06-07T19:21:07.065+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:before</span><br><span class="line">2024-06-07T19:21:07.066+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.AAAop           : AAAop:环绕前</span><br><span class="line">2024-06-07T19:21:07.066+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.AAAop           : AAAop:before</span><br><span class="line">Creating a new SqlSession</span><br><span class="line">Registering transaction synchronization for SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@78944385]</span><br><span class="line">JDBC Connection [HikariProxyConnection@1924583771 wrapping com.mysql.cj.jdbc.ConnectionImpl@74fb5b59] will be managed by Spring</span><br><span class="line">==&gt;  Preparing: update user set name=?,pass=? where id= ?</span><br><span class="line">==&gt; Parameters: 来了(String), 123456(String), 7(Integer)</span><br><span class="line">&lt;==    Updates: 1</span><br><span class="line">Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@78944385]</span><br><span class="line">Transaction synchronization committing SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@78944385]</span><br><span class="line">Transaction synchronization deregistering SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@78944385]</span><br><span class="line">Transaction synchronization closing SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@78944385]</span><br><span class="line">2024-06-07T19:21:07.110+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.AAAop           : AAAop:afterReturning</span><br><span class="line">2024-06-07T19:21:07.110+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.AAAop           : AAAop:after</span><br><span class="line">2024-06-07T19:21:07.110+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.AAAop           : AAAop:环绕后</span><br><span class="line">2024-06-07T19:21:07.111+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:afterReturning</span><br><span class="line">2024-06-07T19:21:07.111+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:after</span><br><span class="line">2024-06-07T19:21:07.111+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:环绕后</span><br><span class="line">2024-06-07T19:21:07.111+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.OrderAop        : Order:afterReturning</span><br><span class="line">2024-06-07T19:21:07.111+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.OrderAop        : Order:after</span><br><span class="line">2024-06-07T19:21:07.111+08:00  INFO 25560 --- [dashijian] [nio-8080-exec-2] com.kirari.dashijian.aop.OrderAop        : Order:环绕后</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>order是1所以最先运行</p>
<p>异常：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">2024-06-07T19:22:43.442+08:00  INFO 24416 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:环绕前</span><br><span class="line">2024-06-07T19:22:43.442+08:00  INFO 24416 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:before</span><br><span class="line">2024-06-07T19:22:43.442+08:00  INFO 24416 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:环绕前</span><br><span class="line">2024-06-07T19:22:43.442+08:00  INFO 24416 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:before</span><br><span class="line">2024-06-07T19:22:43.442+08:00  INFO 24416 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.AAAop           : AAAop:环绕前</span><br><span class="line">2024-06-07T19:22:43.442+08:00  INFO 24416 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.AAAop           : AAAop:before</span><br><span class="line">Creating a new SqlSession</span><br><span class="line">Registering transaction synchronization <span class="keyword">for</span> SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@28dedd9a]</span><br><span class="line">JDBC Connection [HikariProxyConnection@1834732310 wrapping com.mysql.cj.jdbc.ConnectionImpl@74fb5b59] will be managed by Spring</span><br><span class="line">==&gt;  Preparing: update user <span class="built_in">set</span> name=?,pass=? <span class="built_in">where</span> <span class="built_in">id</span>= ?</span><br><span class="line">==&gt; Parameters: 来了(String), 123456(String), 7(Integer)</span><br><span class="line">&lt;==    Updates: 1</span><br><span class="line">Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@28dedd9a]</span><br><span class="line">Transaction synchronization deregistering SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@28dedd9a]</span><br><span class="line">Transaction synchronization closing SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@28dedd9a]</span><br><span class="line">2024-06-07T19:22:43.482+08:00  INFO 24416 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.AAAop           : AAAop:afterThrowing</span><br><span class="line">2024-06-07T19:22:43.482+08:00  INFO 24416 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.AAAop           : AAAop:after</span><br><span class="line">2024-06-07T19:22:43.482+08:00  INFO 24416 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:afterThrowing</span><br><span class="line">2024-06-07T19:22:43.482+08:00  INFO 24416 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.ZZzAop          : ZZzAop:after</span><br><span class="line">2024-06-07T19:22:43.482+08:00  INFO 24416 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:afterThrowing</span><br><span class="line">2024-06-07T19:22:43.482+08:00  INFO 24416 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:after</span><br></pre></td></tr></table></figure>
<p>与理论一致</p>
<hr>
<h3 id="多个相同的切入点表达式抽取"><a href="#多个相同的切入点表达式抽取" class="headerlink" title="多个相同的切入点表达式抽取"></a>多个相同的切入点表达式抽取</h3><p><code>@PointCut</code></p>
<p>通过<code>@PointCut</code>注解可以把相同的地址提取出来取个别名，每次打的切入点表达式的时候就不需要全打出来了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(* com.kirari.dashijian.service.UserService.update(..))&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">kkk</span><span class="params">()</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut(&quot;execution(* com.kirari.dashijian.service.UserService.select(..))&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">lll</span><span class="params">()</span>&#123;&#125;;</span><br></pre></td></tr></table></figure>
<p>类名的修饰符，<code>private</code>代表只能在这个类中使用，其他类要使用要把修饰符改为<code>public</code></p>
<p>本体类中使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderAop</span> &#123;</span><br><span class="line">    <span class="meta">@AfterReturning(&quot;kkk()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order:afterReturning&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其他类中使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AAAop</span> &#123;</span><br><span class="line">    <span class="meta">@AfterReturning(&quot;com.kirari.dashijian.aop.OrderAop.kkk()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;AAAop:afterReturning&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderAop</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.kirari.dashijian.service.UserService.update(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">kkk</span><span class="params">()</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;kkk()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order:afterReturning&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;kkk()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order:afterThrowing&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;kkk()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order:after&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;kkk()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order:before&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;kkk()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">Around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;Order:环绕前&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;Order:环绕后&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="切入点表达式"><a href="#切入点表达式" class="headerlink" title="切入点表达式"></a>切入点表达式</h3><h4 id="execution"><a href="#execution" class="headerlink" title="execution"></a>execution</h4><p><code>execution(访问修饰符号 返回值 包名.类名.方法名(方法参数) throw 异常)</code></p>
<p>其中<strong>访问修饰符</strong>(public/private/protected)、<strong>包名.类名</strong>、<strong>throw 异常</strong>可以省略</p>
<p>完整版例子：<code>@Pointcut(&quot;execution(public int com.kirari.dashijian.service.UserService.update(int) throws Exception)&quot;)</code></p>
<blockquote>
<p>包名.类名不建议省略，会出现匹配不同类与包下的方法，导致不能得到想要的结果</p>
</blockquote>
<p>特殊符号/通配符：</p>
<ul>
<li><p><code>*</code></p>
<p>表示单个独立的任意一个包名/类名/方法名/参数的任意<strong>一个</strong>参数，也可以匹配包、类、方法名的一部分，和上面的拦截器是一致的</p>
</li>
<li><p><code>..</code></p>
<p>任意数目层级的包，任意类型个数的参数</p>
</li>
</ul>
<hr>
<p><code>&quot;execution( * com..UserService.findAllUser(..))&quot;</code></p>
<p>com任意层级下UserService.findAllUser任意参数的方法</p>
<hr>
<p>通配所有包名类名方法名任意参数</p>
<p><code>execution(* *(..))</code></p>
<hr>
<blockquote>
<p><code>@Pointcut(&quot;execution( * com.kirari.dashijian.service.UserService.update())&quot;)</code>参数里没有<code>..</code>或者<code>*</code>的话匹配的是无参数构造()</p>
<p>当参数里是<code>..</code>的话，无参构造也可以实现匹配，但是<code>*</code>必须匹配单个参数</p>
</blockquote>
<p>关于匹配包名/类名/方法名的某一段</p>
<p><code>&quot;execution( * com.kirari.dashijian.service.UserS*.findAllUser(..))&quot;</code></p>
<p>我们看见原来的<code>UserService</code>变成了<code>UserS*</code>，实现了原本的<code>com.kirari.dashijian.service.UserService.findAllUser()</code>方法后，出现了通知信息，所以是像拦截器一样包括匹配一段包名/类名/方法名的</p>
<p>修改为<code>*erS*</code>时也能匹配到，可见一段字符xxxxx，当<code>*</code>在前面匹配xxx为后缀的包名/类名/方法名，<code>*</code>在前面匹配前缀为xxx的包名/类名/方法名，当两头出现<code>*</code>则是匹配中间为xxx的路径</p>
<hr>
<h5 id="复杂判断"><a href="#复杂判断" class="headerlink" title="复杂判断"></a>复杂判断</h5><p>可以通过<code>||</code>、<code>&amp;&amp;</code>、<code>!</code>组合进行复杂判断</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution( * com..UserService.findAllUser(..) ) ||&quot; +</span></span><br><span class="line"><span class="meta">        &quot;execution(* com.kirari.dashijian.service.UserService.update(..))&quot;</span></span><br><span class="line"><span class="meta">         )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut(&quot;execution( * com..UserService.findAllUser(..) ) &amp;&amp;&quot; +</span></span><br><span class="line"><span class="meta">          &quot;execution(* *(..))&quot;</span></span><br><span class="line"><span class="meta">         )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut(&quot;execution(* *(..)) &amp;&amp;&quot;+</span></span><br><span class="line"><span class="meta">          &quot;!execution( * com..UserService.findAllUser(..) ) &quot;</span></span><br><span class="line"><span class="meta">         )</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="annotation-、-within"><a href="#annotation-、-within" class="headerlink" title="@annotation()、@within()"></a>@annotation()、@within()</h4><ul>
<li><p>@annotation() 使用注解来定位匹配方法</p>
</li>
<li><p>@within() 使用注解定位匹配接口、类</p>
</li>
</ul>
<p>首先先定义一个自定义注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE ,ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AopTest &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>ElementType.METHOD</code>注解可以应用于方法</li>
<li><code>ElementType.TYPE</code>注解可以应用于类、接口（包括注解类型）或枚举声明</li>
</ul>
<p>Aop类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;@within(AopTest)||&quot; +</span></span><br><span class="line"><span class="meta">        &quot;@annotation(AopTest)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">kkk</span><span class="params">()</span>&#123;&#125;;</span><br></pre></td></tr></table></figure>
<p>在类上使用注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AopTest</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StudentMapper studentMapper;</span><br><span class="line">        <span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">getStudent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> studentMapper.selectStudent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在方法上使用注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    <span class="meta">@AopTest</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;user&gt; <span class="title function_">findAllUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.findAllUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>想在想使用的方法/类上进行切片，就是用注解就可以控制到了</p>
<hr>
<h3 id="在aop中获取连接点信息"><a href="#在aop中获取连接点信息" class="headerlink" title="在aop中获取连接点信息"></a>在aop中获取连接点信息</h3><p>around可以使用ProceedingJoinPoint类的方法而其他的四个通知类只有使用JoinPoint这个方法</p>
<p>JoinPoint是ProceedingJoinPoint的父类</p>
<p>核心方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> joinPoint.getTarget().getClass().getName(); <span class="comment">//获取类名</span></span><br><span class="line"><span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();					<span class="comment">//获取目标对象名字</span></span><br><span class="line"><span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();			<span class="comment">//获取方法名</span></span><br><span class="line">Object[] args = joinPoint.getArgs();						<span class="comment">//获取参数</span></span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;类名：&quot;</span>+className);</span><br><span class="line">System.out.println(<span class="string">&quot;方法名称: &quot;</span> + methodName);</span><br><span class="line">System.out.println(<span class="string">&quot;目标对象: &quot;</span> + signature);</span><br><span class="line">System.out.println(<span class="string">&quot;参数: &quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (Object arg : args) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot; - &quot;</span> + arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderAop</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@within(AopTest)||&quot; +</span></span><br><span class="line"><span class="meta">            &quot;@annotation(AopTest)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">kkk</span><span class="params">()</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;kkk()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order:afterReturning&quot;</span>);</span><br><span class="line">        printJoinPoint(joinPoint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;kkk()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order:afterThrowing&quot;</span>);</span><br><span class="line">        printJoinPoint(joinPoint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;kkk()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order:after&quot;</span>);</span><br><span class="line">        printJoinPoint(joinPoint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;kkk()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;Order:before&quot;</span>);</span><br><span class="line">        printJoinPoint(joinPoint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;kkk()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">Around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;Order:环绕前&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line"></span><br><span class="line">        printJoinPoint(joinPoint);</span><br><span class="line">        </span><br><span class="line">        log.info(<span class="string">&quot;Order:环绕后&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printJoinPoint</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> joinPoint.getTarget().getClass().getName();</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> joinPoint.getSignature();</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;类名：&quot;</span>+className);</span><br><span class="line">        System.out.println(<span class="string">&quot;方法名称: &quot;</span> + methodName);</span><br><span class="line">        System.out.println(<span class="string">&quot;目标对象: &quot;</span> + signature);</span><br><span class="line">        System.out.println(<span class="string">&quot;参数: &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Object arg : args) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot; - &quot;</span> + arg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">2024-06-08T02:39:28.477+08:00  INFO 28640 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:环绕前</span><br><span class="line">2024-06-08T02:39:28.477+08:00  INFO 28640 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:before</span><br><span class="line">类名：com.kirari.dashijian.service.StudentService</span><br><span class="line">方法名称: findStudentIdName</span><br><span class="line">目标对象: Student com.kirari.dashijian.service.StudentService.findStudentIdName(Integer,String)</span><br><span class="line">参数: </span><br><span class="line"> - 1</span><br><span class="line"> - 张三</span><br><span class="line">2024-06-08T02:39:28.536+08:00  INFO 28640 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:afterReturning</span><br><span class="line">类名：com.kirari.dashijian.service.StudentService</span><br><span class="line">方法名称: findStudentIdName</span><br><span class="line">目标对象: Student com.kirari.dashijian.service.StudentService.findStudentIdName(Integer,String)</span><br><span class="line">参数: </span><br><span class="line"> - 1</span><br><span class="line"> - 张三</span><br><span class="line">2024-06-08T02:39:28.537+08:00  INFO 28640 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:after</span><br><span class="line">类名：com.kirari.dashijian.service.StudentService</span><br><span class="line">方法名称: findStudentIdName</span><br><span class="line">目标对象: Student com.kirari.dashijian.service.StudentService.findStudentIdName(Integer,String)</span><br><span class="line">参数: </span><br><span class="line"> - 1</span><br><span class="line"> - 张三</span><br><span class="line"> </span><br><span class="line">类名：com.kirari.dashijian.service.StudentService</span><br><span class="line">方法名称: findStudentIdName</span><br><span class="line">目标对象: Student com.kirari.dashijian.service.StudentService.findStudentIdName(Integer,String)</span><br><span class="line">参数: </span><br><span class="line"> - 1</span><br><span class="line"> - 张三</span><br><span class="line">2024-06-08T02:39:28.537+08:00  INFO 28640 --- [dashijian] [nio-8080-exec-1] com.kirari.dashijian.aop.OrderAop        : Order:环绕后</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>都可以查询到目标对象的 信息</p>
<hr>
<h2 id="SpringDATA自动设置CRUD"><a href="#SpringDATA自动设置CRUD" class="headerlink" title="SpringDATA自动设置CRUD"></a>SpringDATA自动设置CRUD</h2><p>JPA</p>
<p>依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>springboot貌似集成了</p>
<p>实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span>    <span class="comment">//设置实体类</span></span><br><span class="line"><span class="meta">@TableName(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">user</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span>  <span class="comment">//主键</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span><span class="comment">//映射sql表列名</span></span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    String name,pass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>持久层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*<span class="doctag">@Repository</span>已经不是必须引入了</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;user, Long&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//类似 mybatis-plus</span></span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/select&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;user&gt; <span class="title function_">returnUser</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> userRepository.findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不在本包的时候,在启动类引入其他包 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableJpaRepositories(basePackages = &quot;com.kirari.dashijian.dao&quot;)</span></span><br></pre></td></tr></table></figure>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="对于响应格式的统一"><a href="#对于响应格式的统一" class="headerlink" title="对于响应格式的统一"></a>对于响应格式的统一</h3><p>响应数据给前端，有时候是数组、字符串、int型数值，又或者是List型，混乱不堪的格式交杂，没有规范可言。</p>
<p>定义一种响应格式给前端，前端可以更好的接收数据</p>
<p>一个响应数据应该有响应码、响应信息和响应数据这三种</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    *	响应码</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="type">int</span> code;</span><br><span class="line">    <span class="comment">//响应信息</span></span><br><span class="line">    String message;</span><br><span class="line">	<span class="comment">//数据data</span></span><br><span class="line">    Object data;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">(<span class="type">int</span> code, String message, Object data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">error</span><span class="params">(<span class="type">int</span> code, String message, Object data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">success</span><span class="params">(<span class="type">int</span> code, String message, Object data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="配置信息"><a href="#配置信息" class="headerlink" title="配置信息"></a>配置信息</h3><h4 id="配置文件不同方式、配置文件顺序"><a href="#配置文件不同方式、配置文件顺序" class="headerlink" title="配置文件不同方式、配置文件顺序"></a>配置文件不同方式、配置文件顺序</h4><p>优先级从低到高</p>
<ul>
<li>yaml</li>
<li>yml</li>
<li><p>properties</p>
</li>
<li><p>java系统属性/环境变量</p>
</li>
<li>命令行参数</li>
</ul>
<p>打包后可以在同目录下配置一个配置文件.yml进行配置信息，优先级大于jar源项目的.yml配置，小于环境变量和命令行参数</p>
<h4 id="多个环境部署"><a href="#多个环境部署" class="headerlink" title="多个环境部署"></a>多个环境部署</h4><p>同一个项目运行、测试、生产、部署的环境不一样，例如数据库等等，难道要把项目重新生成一份写下不同的配置页面吗？</p>
<p>单个文件中可以在配置<code>---</code>分隔不同的配置</p>
<h5 id="单文件"><a href="#单文件" class="headerlink" title="单文件"></a>单文件</h5><p><code>application.yml</code></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认配置</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置环境所属</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 开发环境配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">activate:</span></span><br><span class="line">      <span class="attr">on-profile:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 测试环境配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">activate:</span></span><br><span class="line">      <span class="attr">on-profile:</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8082</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 生产环境配置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">activate:</span></span><br><span class="line">      <span class="attr">on-profile:</span> <span class="string">prod</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果默认环境中已有配置，但是单独配置的配置会优先启用，覆盖掉默认配置，例如上面的 配置中默认配置了8080端口，但是优先启用了dev环境，访问8080的时候是无法获得界面，而访问8081才可以访问界面</p>
</blockquote>
<p>使用<code>---</code>分隔不同环境配置。</p>
<p>由以下属性值取名称</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">activate:</span></span><br><span class="line">      <span class="attr">on-profile:</span> <span class="string">name</span></span><br></pre></td></tr></table></figure>
<p>在默认环境中使用名称来设置当前环境值</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>
<p>这是运行后的提示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2024-06-10T15:13:16.224+08:00  INFO 5196 --- [dashijian] [           main] c.kirari.dashijian.DashijianApplication  : The following 1 profile is active: &quot;dev&quot;</span><br><span class="line">2024-06-10T15:13:16.856+08:00  INFO 5196 --- [dashijian] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.</span><br><span class="line">2024-06-10T15:13:16.888+08:00  INFO 5196 --- [dashijian] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 26 ms. Found 1 JPA repository interface.</span><br><span class="line">2024-06-10T15:13:17.435+08:00  INFO 5196 --- [dashijian] [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8081 (http)</span><br></pre></td></tr></table></figure>
<p>默认环境中可以配置不同环境中共有的配置而不用单独每个都声明一遍,会在不同配置上生效</p>
<p>使用命令行指定激活的配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用开发环境配置</span></span><br><span class="line">java -jar myapp.jar --spring.profiles.active=dev</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用测试环境配置</span></span><br><span class="line">java -jar myapp.jar --spring.profiles.active=test</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用生产环境配置</span></span><br><span class="line">java -jar myapp.jar --spring.profiles.active=prod</span><br></pre></td></tr></table></figure>
<p>环境变量指定配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">export SPRING_PROFILES_ACTIVE=dev</span><br><span class="line">java -jar myapp.jar</span><br><span class="line"></span><br><span class="line">export SPRING_PROFILES_ACTIVE=test</span><br><span class="line">java -jar myapp.jar</span><br><span class="line"></span><br><span class="line">export SPRING_PROFILES_ACTIVE=prod</span><br><span class="line">java -jar myapp.jar</span><br></pre></td></tr></table></figure>
<h5 id="多文件"><a href="#多文件" class="headerlink" title="多文件"></a>多文件</h5><p>如果把所有的文件配置都写到同一个 文件下很臃肿</p>
<p>文件目录如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">├── main</span><br><span class="line">│   ├── java</span><br><span class="line">│   │   └── com</span><br><span class="line">│   │       └── example</span><br><span class="line">│   │           └── demo</span><br><span class="line">│   │               ├── DemoApplication.java</span><br><span class="line">│   └── resources</span><br><span class="line">│       ├── application.yml</span><br><span class="line">│       ├── application-dev.yml</span><br><span class="line">│       ├── application-test.yml</span><br><span class="line">│       └── application-prod.yml</span><br></pre></td></tr></table></figure>
<p> <code>application.yml</code></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定配置文件</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>
<p> <code>application-dev.yml</code></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-dev.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></table></figure>
<p><code>application-test.yml</code></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-test.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8082</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>  <code>application-prod.yml</code></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-prod.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br></pre></td></tr></table></figure>
<p>通过这种方式可以配置你想使用的环境</p>
<h5 id="多文件且分组"><a href="#多文件且分组" class="headerlink" title="多文件且分组"></a>多文件且分组</h5><p>虽然是多文件设置不同环境的配置显得不臃肿了，但是当个文件里写满了所有配置还是不容易查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">├── main</span><br><span class="line">│   ├── java</span><br><span class="line">│   │   └── com</span><br><span class="line">│   │       └── example</span><br><span class="line">│   │           └── demo</span><br><span class="line">│   │               ├── config</span><br><span class="line">│   │               │   └── DataSourceConfig.java</span><br><span class="line">│   │               ├── service</span><br><span class="line">│   │               │   └── DataSourceService.java</span><br><span class="line">│   │               ├── DemoApplication.java</span><br><span class="line">│   └── resources</span><br><span class="line">│       ├── application.yml</span><br><span class="line">│       ├── application-devServer.yml</span><br><span class="line">│       ├── application-devServer.yml</span><br><span class="line">│       ├── application-devSelf.yml</span><br><span class="line">│       ├── application-test.yml</span><br><span class="line">│       └── application-prod.yml</span><br></pre></td></tr></table></figure>
<p>此时的 <code>application-devServer.yml</code>、<code>application-devDB.yml</code>、<code>application-devSelf.yml</code>，配置着不同类型的配置</p>
<p>在<code>application.yml</code>中</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">    <span class="attr">group:</span></span><br><span class="line">      <span class="attr">&quot;dev&quot;:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">devServer</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">devDb</span></span><br><span class="line">      <span class="attr">por:</span> <span class="string">pro,proDb</span></span><br></pre></td></tr></table></figure>
<p>俩种方式都可以实现分组功能</p>
<h3 id="自动实现Get、Set、ToString"><a href="#自动实现Get、Set、ToString" class="headerlink" title="自动实现Get、Set、ToString"></a>自动实现Get、Set、ToString</h3><ol>
<li><p><code>lombok</code>依赖</p>
</li>
<li><p>使用注解@Data</p>
</li>
<li>可选<code>@NoArgsConstructor</code>无参数构造方法、<code>@AllArgsConstructor</code>全参数构造方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="type">int</span> id,age;</span><br><span class="line">    String studentId,name,password,sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><p><code>@Slf4j</code></p>
<p><code>lombok</code>依赖</p>
<p><a target="_blank" rel="noopener" href="https://projectlombok.org/features/log">@Log (and friends) (projectlombok.org)</a></p>
<p>有几种选择：</p>
<ul>
<li><p><code>@CommonsLog</code></p>
<p>创建<code>private static final org.apache.commons.logging.Log log = org.apache.commons.logging.LogFactory.getLog(LogExample.class);</code></p>
</li>
<li><p><code>@Flogger</code></p>
<p>创建<code>private static final com.google.common.flogger.FluentLogger log = com.google.common.flogger.FluentLogger.forEnclosingClass();</code></p>
</li>
<li><p><code>@JBossLog</code></p>
<p>创建<code>private static final org.jboss.logging.Logger log = org.jboss.logging.Logger.getLogger(LogExample.class);</code></p>
</li>
<li><p><code>@Log</code></p>
<p>创建<code>private static final java.util.logging.Logger log = java.util.logging.Logger.getLogger(LogExample.class.getName());</code></p>
</li>
<li><p><code>@Log4j</code></p>
<p>创建<code>private static final org.apache.log4j.Logger log = org.apache.log4j.Logger.getLogger(LogExample.class);</code></p>
</li>
<li><p><code>@Log4j2</code></p>
<p>创建<code>private static final org.apache.logging.log4j.Logger log = org.apache.logging.log4j.LogManager.getLogger(LogExample.class);</code></p>
</li>
<li><p><code>@Slf4j</code></p>
<p>创建<code>private static final org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(LogExample.class);</code></p>
</li>
<li><p><code>@XSlf4j</code></p>
<p>创建<code>private static final org.slf4j.ext.XLogger log = org.slf4j.ext.XLoggerFactory.getXLogger(LogExample.class);</code></p>
</li>
<li><p><code>@CustomLog</code></p>
<p>创建<code>private static final *com.foo.your.Logger* log = *com.foo.your.LoggerFactory.createYourLogger*(LogExample.class);</code>此选项<em>要求</em>您向 <a target="_blank" rel="noopener" href="https://projectlombok.org/features/configuration"><code>lombok.config</code></a> 文件添加配置以指定应执行的操作。<code>@CustomLog</code></p>
</li>
</ul>
<p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StudentService studentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/student&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">getStudent</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  studentService.getStudent();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;student/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">getStudentId</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;这是查找学生&quot;</span>+id);</span><br><span class="line">        <span class="keyword">return</span>  studentService.findStudentId(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="本地存储"><a href="#本地存储" class="headerlink" title="本地存储"></a>本地存储</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">file</span><span class="params">(MultipartFile image)</span>&#123;</span><br><span class="line"><span class="comment">//        取出文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> image.getOriginalFilename();</span><br><span class="line"><span class="comment">//        存入位置</span></span><br><span class="line">        image.transferTo(<span class="keyword">new</span>  <span class="title class_">File</span>(<span class="string">&quot;E:\\image\\&quot;</span>+fileName));</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>避免文件名重复，按需使用UUID命名</p>
<p>常用方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">file</span> <span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    </span><br><span class="line">    file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;文件路径&quot;</span>));</span><br><span class="line">    <span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> file.getSize();<span class="comment">//文件大小</span></span><br><span class="line">    <span class="type">byte</span>[] bytes  = file.getBytes(); <span class="comment">//文件内容字节数组</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> file.getOriginalFilename();<span class="comment">//原始名</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> file.getName();<span class="comment">//表单字段名</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> file.getInputStream();<span class="comment">//文件内容输入流</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="参数配置化"><a href="#参数配置化" class="headerlink" title="参数配置化"></a>参数配置化</h3><p>在类中使用的常量，或者多处使用但是值是一样的可以通过配置来统一管理</p>
<p><code>application.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">User:</span></span><br><span class="line">  <span class="attr">test:</span></span><br><span class="line">    <span class="attr">id:</span> <span class="number">2115080124</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">kirari</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>User2类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">user2</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;User.test.id&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;User.test.name&#125;&quot;)</span></span><br><span class="line">    String name;</span><br><span class="line">    </span><br><span class="line">    Info info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(user2.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user2(<span class="built_in">id</span>=2115080124, name=kirari, info=null)</span><br></pre></td></tr></table></figure>
<hr>
<p>简略写法/复杂类实现</p>
<p>user2类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;user.test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">user2</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    String name;</span><br><span class="line">    Info info;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>info 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Info</span> &#123;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    String address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">User:</span></span><br><span class="line">  <span class="attr">test:</span></span><br><span class="line">    <span class="attr">id:</span> <span class="number">2115080124</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">kirari</span></span><br><span class="line">    <span class="attr">info:</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">      <span class="attr">address:</span> <span class="string">gx</span></span><br></pre></td></tr></table></figure>
<p>启动类需要配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(user2.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DashijianApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DashijianApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Test类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">user2 user2 ;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(user2.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user2(<span class="built_in">id</span>=2115080124, name=kirari, info=Info(age=18, address=gx))</span><br></pre></td></tr></table></figure>
<p>未匹配到的配置会显示0或者null</p>
<p>修改后的user2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;user.test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">user2</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    String name;</span><br><span class="line">    Info info;</span><br><span class="line">    <span class="type">int</span> ss;</span><br><span class="line">    String test;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user2(<span class="built_in">id</span>=2115080124, name=kirari, info=Info(age=18, address=gx), ss=0, <span class="built_in">test</span>=null)</span><br></pre></td></tr></table></figure>
<hr>
<p>数组赋值</p>
<p>配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hobby: c++,java,python,php</span><br></pre></td></tr></table></figure>
<p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    @Value(&quot;#&#123;&#x27;$&#123;hobby&#125;&#x27;&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;hobby&#125;&quot;)</span></span><br><span class="line"><span class="comment">//    private String[] hobby;</span></span><br><span class="line"><span class="comment">//    private List&lt;String&gt; hobby;</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt;hobby;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//        System.out.println(hobby.length);</span></span><br><span class="line"><span class="comment">//        System.out.println(Arrays.toString(hobby));</span></span><br><span class="line">        System.out.println(hobby.toString());</span><br><span class="line">        <span class="keyword">for</span> (String h:hobby) &#123;</span><br><span class="line">            System.out.println(h);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>以上均可实现</p>
<p>还有更多方法：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44761854/article/details/136369598">SpringBoot 中yml配置文件：定义list集合、数组及注意事项_springboot yml list-CSDN博客</a></p>
<p>偷个懒，不尝试了</p>
<hr>
<h3 id="JsonIgnore"><a href="#JsonIgnore" class="headerlink" title="JsonIgnore"></a>JsonIgnore</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">user</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    String  pass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>往前端传递回数值使用SpringMVC转化json模式的时候，如果不想要某个值传递回去就使用<code>com.fasterxml.jackson.annotation.JsonIgnore;</code>下 的<code>@JsonIgnore</code>忽略它，不随着其他属性一起转化到前端</p>
<h3 id="使用注解进行参数校验"><a href="#使用注解进行参数校验" class="headerlink" title="使用注解进行参数校验"></a>使用注解进行参数校验</h3><p>实体类中声明对象时加入注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PUserPUserEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^\\S&#123;2,4&#125;$&quot;,message = &quot;请正确输入格式&quot;)</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String pName;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotEmpty</span></span><br><span class="line">    <span class="keyword">private</span> String pPass;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="keyword">private</span> String pEmil;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@URL</span></span><br><span class="line">    <span class="keyword">private</span> String pUrl;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注解值分别为</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>注解</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>NotNull</td>
<td>不能为null</td>
</tr>
<tr>
<td>NotEmpty</td>
<td>不能为null且置不为空</td>
</tr>
<tr>
<td>Pattern</td>
<td>正则表达式</td>
</tr>
<tr>
<td>Email</td>
<td>邮箱格式</td>
</tr>
<tr>
<td>URL</td>
<td>网址格式</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>其中message属性可以自定义报错信息</p>
</blockquote>
<p>在接收参数时加入</p>
<p><code>@Validated</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/allP&quot;)</span></span><br><span class="line"><span class="keyword">public</span> PUserPUserEntity <span class="title function_">getAllId</span><span class="params">(<span class="meta">@Validated</span> PUserPUserEntity pUserPUserEntity)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  pUserService.getall(pUserPUserEntity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输入的值不符合参数的会报出错误返回异常</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">024-06-09T20:56:38.228+08:00  WARN 18192 --- [dashijian] [nio-8080-exec-1] .w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed <span class="keyword">for</span> argument [0] <span class="keyword">in</span> public com.kirari.dashijian.poyo.PUserPUserEntity com.kirari.dashijian.controller.PUserController.getAllId(com.kirari.dashijian.poyo.PUserPUserEntity): [Field error <span class="keyword">in</span> object <span class="string">&#x27;PUserPUserEntity&#x27;</span> on field <span class="string">&#x27;pEmil&#x27;</span>: rejected value [1244118445qq.com]; codes [Email.PUserPUserEntity.pEmil,Email.pEmil,Email.java.lang.String,Email]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [PUserPUserEntity.pEmil,pEmil]; arguments []; default message [pEmil],[Ljakarta.validation.constraints.Pattern<span class="variable">$Flag</span>;@668a56ea,.*]; default message [不是一个合法的电子邮件地址]] ]</span><br><span class="line">2024-06-09T20:57:04.709+08:00  WARN 18192 --- [dashijian] [nio-8080-exec-4] .w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed <span class="keyword">for</span> argument [0] <span class="keyword">in</span> public com.kirari.dashijian.poyo.PUserPUserEntity com.kirari.dashijian.controller.PUserController.getAllId(com.kirari.dashijian.poyo.PUserPUserEntity): [Field error <span class="keyword">in</span> object <span class="string">&#x27;PUserPUserEntity&#x27;</span> on field <span class="string">&#x27;pUrl&#x27;</span>: rejected value [htt]; codes [URL.PUserPUserEntity.pUrl,URL.pUrl,URL.java.lang.String,URL]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [PUserPUserEntity.pUrl,pUrl]; arguments []; default message [pUrl],[Ljakarta.validation.constraints.Pattern<span class="variable">$Flag</span>;@1cbf9fc2,,-1,,.*]; default message [需要是一个合法的URL]] ]</span><br><span class="line">2024-06-09T20:57:14.523+08:00  WARN 18192 --- [dashijian] [nio-8080-exec-2] .w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed <span class="keyword">for</span> argument [0] <span class="keyword">in</span> public com.kirari.dashijian.poyo.PUserPUserEntity com.kirari.dashijian.controller.PUserController.getAllId(com.kirari.dashijian.poyo.PUserPUserEntity): [Field error <span class="keyword">in</span> object <span class="string">&#x27;PUserPUserEntity&#x27;</span> on field <span class="string">&#x27;pName&#x27;</span>: rejected value [dadddd]; codes [Pattern.PUserPUserEntity.pName,Pattern.pName,Pattern.java.lang.String,Pattern]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [PUserPUserEntity.pName,pName]; arguments []; default message [pName],[Ljakarta.validation.constraints.Pattern<span class="variable">$Flag</span>;@36c19847,^\S&#123;2,4&#125;$]; default message [请正确输入格式]] ]</span><br><span class="line">2024-06-09T21:11:09.888+08:00  WARN 18192 --- [dashijian] [nio-8080-exec-8] .w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed <span class="keyword">for</span> argument [0] <span class="keyword">in</span> public com.kirari.dashijian.poyo.PUserPUserEntity com.kirari.dashijian.controller.PUserController.getAllId(com.kirari.dashijian.poyo.PUserPUserEntity): [Field error <span class="keyword">in</span> object <span class="string">&#x27;PUserPUserEntity&#x27;</span> on field <span class="string">&#x27;pPass&#x27;</span>: rejected value [null]; codes [NotEmpty.PUserPUserEntity.pPass,NotEmpty.pPass,NotEmpty.java.lang.String,NotEmpty]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [PUserPUserEntity.pPass,pPass]; arguments []; default message [pPass]]; default message [不能为空]] ]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>也可以在接收参数的时候使用注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/emil&quot;)</span></span><br><span class="line"><span class="keyword">public</span> PUserPUserEntity <span class="title function_">getAllId</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@Email</span> String PEmil)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  pUserService.getEmil(PEmil);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>带不带@Validated 好像都行</p>
</blockquote>
<p>此时输入的格式不是邮箱格式就会请求错误返回异常</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2024</span><span class="number">-06</span><span class="number">-09</span>T21<span class="punctuation">:</span><span class="number">26</span><span class="punctuation">:</span><span class="number">33.150</span>+<span class="number">08</span><span class="punctuation">:</span><span class="number">00</span>  INFO <span class="number">31052</span> --- <span class="punctuation">[</span>dashijian<span class="punctuation">]</span> <span class="punctuation">[</span>nio<span class="number">-8080</span>-exec<span class="number">-1</span><span class="punctuation">]</span> c.k.d.exception.GlobalExceptionHandler   <span class="punctuation">:</span> 异常！</span><br><span class="line"><span class="number">2024</span><span class="number">-06</span><span class="number">-09</span>T21<span class="punctuation">:</span><span class="number">26</span><span class="punctuation">:</span><span class="number">33.151</span>+<span class="number">08</span><span class="punctuation">:</span><span class="number">00</span>  INFO <span class="number">31052</span> --- <span class="punctuation">[</span>dashijian<span class="punctuation">]</span> <span class="punctuation">[</span>nio<span class="number">-8080</span>-exec<span class="number">-1</span><span class="punctuation">]</span> c.k.d.exception.GlobalExceptionHandler   <span class="punctuation">:</span> <span class="number">400</span> BAD_REQUEST <span class="string">&quot;Validation failure&quot;</span></span><br><span class="line"><span class="number">2024</span><span class="number">-06</span><span class="number">-09</span>T21<span class="punctuation">:</span><span class="number">26</span><span class="punctuation">:</span><span class="number">33.151</span>+<span class="number">08</span><span class="punctuation">:</span><span class="number">00</span>  INFO <span class="number">31052</span> --- <span class="punctuation">[</span>dashijian<span class="punctuation">]</span> <span class="punctuation">[</span>nio<span class="number">-8080</span>-exec<span class="number">-1</span><span class="punctuation">]</span> c.k.d.exception.GlobalExceptionHandler   <span class="punctuation">:</span> org.springframework.web.method.annotation.HandlerMethodValidationException<span class="punctuation">:</span> <span class="number">400</span> BAD_REQUEST <span class="string">&quot;Validation failure&quot;</span></span><br><span class="line"><span class="number">2024</span><span class="number">-06</span><span class="number">-09</span>T21<span class="punctuation">:</span><span class="number">26</span><span class="punctuation">:</span><span class="number">33.151</span>+<span class="number">08</span><span class="punctuation">:</span><span class="number">00</span>  INFO <span class="number">31052</span> --- <span class="punctuation">[</span>dashijian<span class="punctuation">]</span> <span class="punctuation">[</span>nio<span class="number">-8080</span>-exec<span class="number">-1</span><span class="punctuation">]</span> c.k.d.exception.GlobalExceptionHandler   <span class="punctuation">:</span> class org.springframework.web.method.annotation.HandlerMethodValidationException</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="同一个实体类对多个请求的适应"><a href="#同一个实体类对多个请求的适应" class="headerlink" title="同一个实体类对多个请求的适应"></a>同一个实体类对多个请求的适应</h3><h4 id="DTO、VO、PO"><a href="#DTO、VO、PO" class="headerlink" title="DTO、VO、PO"></a>DTO、VO、PO</h4><div class="table-container">
<table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>用途</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr>
<td>DTO</td>
<td>Data Transfer Object (数据传输对象)</td>
<td>用于在不同系统或不同层之间传输数据。</td>
<td>- 通常是简单的 Java 类（POJO），只包含属性和 getter/setter 方法。<br> - 没有业务逻辑，只是用于传输数据。<br> - 可以进行序列化，方便网络传输。</td>
</tr>
<tr>
<td>VO</td>
<td>Value Object (值对象)</td>
<td>用于表示业务模型中的值，通常用于表示不可变的业务对象。<br> 在视图层与服务层之间传递数据，常用于展示层。</td>
<td>- 通常是不可变对象，一旦创建就不能修改其内部状态。<br> - 只包含数据，没有业务逻辑。</td>
</tr>
<tr>
<td>PO</td>
<td>Persistent Object (持久化对象)</td>
<td>对应数据库中的表，用于持久化数据。<br> 通常在数据访问层使用。</td>
<td>- 通常是简单的 Java 类（POJO），每个属性对应数据库表的一列。<br> - 包含业务实体的状态，与数据库表结构紧密对应。<br> - 可能包含简单的业务逻辑，但主要用于数据持久化。</td>
</tr>
</tbody>
</table>
</div>
<p>在请求时不同、响应数据、持久层数据库访问的时候，如果遇到与实体类poyo不一样的结构，可以定义这么一些dto、vo、po来扩充、缩小不同的需求类</p>
<p>例如user.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">user</span>&#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前端传输数据却包含一个Emil</p>
<p>这时候就可以设置一个类</p>
<p>userDto.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">userDto</span>&#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    String name;</span><br><span class="line">    String Emil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果数据库想要存入修改时间，设置userPo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">userPo</span>&#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    String name;</span><br><span class="line">    String Date;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据业务需求灵活定制，节约传输数据的流量，性能优化等等</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ma726518972/article/details/118757478">Spring项目中，为什么要区分PO对象，VO对象，DTO对象？有什么作用？_vo撖寡情-CSDN博客</a></p>
</blockquote>
<hr>
<h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><p>建立太多的类不方便管理，在一个类中利用Validated 的groups属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PUserPUserEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull(groups = &#123;Dto.class,Po.class&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^\\S&#123;2,4&#125;$&quot;,message = &quot;请正确输入格式&quot;,groups = &#123;Dto.class,Po.class&#125;)</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String pName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotEmpty(groups = Dto.class)</span></span><br><span class="line">    <span class="keyword">private</span> String pPass;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Email(groups = Po.class)</span></span><br><span class="line">    <span class="keyword">private</span> String pEmil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@URL</span></span><br><span class="line">    <span class="keyword">private</span> String pUrl;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//设置分组名</span></span><br><span class="line"> 	<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Dto</span>&#123;&#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Po</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在使用PUserPUserEntity.java实体类的时候加上注解<code>@Validated(PUserPUserEntity.分组名.class)</code>，例如<code>@Validated(PUserPUserEntity.Dto.class)</code></p>
<p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/allP&quot;)</span></span><br><span class="line"><span class="keyword">public</span> PUserPUserEntity <span class="title function_">getAllId</span><span class="params">(<span class="meta">@Validated(PUserPUserEntity.Dto.class)</span> PUserPUserEntity pUserPUserEntity)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  pUserService.getall(pUserPUserEntity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就置使用注解中包含Dto.class的属性了</p>
<p>实体类中所有字段默认是<code>Default</code>分组的，如果所有的分组中均有这个字段，可以省略设置，让分组继承Default这个分组，这个新的分组就拥有了默认的分组字段，不需要单独设置所有分组都有的字段了</p>
<p>例如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PUserPUserEntity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^\\S&#123;2,4&#125;$&quot;,message = &quot;请正确输入格式&quot;)</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String pName;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotEmpty(groups = Dto.class)</span></span><br><span class="line">    <span class="keyword">private</span> String pPass;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Email(groups = Po.class)</span></span><br><span class="line">    <span class="keyword">private</span> String pEmil;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@URL</span></span><br><span class="line">    <span class="keyword">private</span> String pUrl;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//设置分组名</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Dto</span> <span class="keyword">extends</span> <span class="title class_">Default</span> &#123;&#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Po</span> <span class="keyword">extends</span>  <span class="title class_">Default</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意Default引入的包是<code>import jakarta.validation.groups.Default;</code></p>
</blockquote>
<p>没有设置分组的默认为Default分组，各个分组又继承了Default，所以各个分组拥有未设置分组的字段。</p>
<p>并且通过分组设置，让这个实体类实现不同层的数据流通</p>
<hr>
<h3 id="注解进行参数校验的原理以及自定义校验"><a href="#注解进行参数校验的原理以及自定义校验" class="headerlink" title="注解进行参数校验的原理以及自定义校验"></a>注解进行参数校验的原理以及自定义校验</h3><p>我们点开Validated 包下的任意一个注解，例如<code>NotEmpty</code>，以下是他的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span><span class="comment">//javadoc</span></span><br><span class="line"><span class="meta">@Constraint( //指定提供校验规则的类</span></span><br><span class="line"><span class="meta">    validatedBy = &#123;&#125;</span></span><br><span class="line"><span class="meta">)</span>  </span><br><span class="line"><span class="comment">//注解生效的区域</span></span><br><span class="line"><span class="comment">//其中ElementType.FIELD是变量</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER, ElementType.TYPE_USE&#125;)</span></span><br><span class="line"><span class="comment">//在运行是运行</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Repeatable(List.class)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> NotEmpty &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//提示信息</span></span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&#123;jakarta.validation.constraints.NotEmpty.message&#125;&quot;</span>;</span><br><span class="line"><span class="comment">//分组</span></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"><span class="comment">//负载</span></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Target(&#123;ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER, ElementType.TYPE_USE&#125;)</span></span><br><span class="line">    <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">    <span class="meta">@Documented</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@interface</span> List &#123;</span><br><span class="line">        NotEmpty[] value();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>找了好久找到了判断逻辑的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotNullValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;NotNull, Object&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NotNullValidator</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(Object object, ConstraintValidatorContext constraintValidatorContext)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> object != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>看到引入了接口<code>ConstraintValidator</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConstraintValidator</span>&lt;A <span class="keyword">extends</span> <span class="title class_">Annotation</span>, T&gt; &#123;</span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(A constraintAnnotation)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(T var1, ConstraintValidatorContext var2)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中</p>
<ul>
<li><p><code>A extends Annotation</code>是指给哪个注解校验规则</p>
</li>
<li><p>T，校验的数据类型</p>
</li>
</ul>
<p>如果<code>isValid</code>函数返回true则校验通过，如果返回false则校验失败输出message。</p>
<p>这个就是注解去实现参数校验的原理</p>
<h4 id="自定义校验注解"><a href="#自定义校验注解" class="headerlink" title="自定义校验注解"></a>自定义校验注解</h4><p>自定义注解Phone</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.PARAMETER, ElementType.FIELD&#125;)</span> <span class="comment">// 可以用于字段和方法参数</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Constraint(</span></span><br><span class="line"><span class="meta">        validatedBy = &#123;PhoneValidation.class&#125; ////指定提供校验规则的类</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Phone &#123;</span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&#123;手机号码需要11位数字&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>配置验证规则</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PhoneValidation</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;Phone,String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(Phone constraintAnnotation)</span> &#123;</span><br><span class="line">        ConstraintValidator.<span class="built_in">super</span>.initialize(constraintAnnotation);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s, ConstraintValidatorContext constraintValidatorContext)</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> s != <span class="literal">null</span> &amp;&amp; s.matches( <span class="string">&quot;^\\d&#123;11&#125;$&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/phone&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">phone</span><span class="params">(<span class="meta">@Validated</span> <span class="meta">@Phone</span> String p)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请求：<code>http://127.0.0.1:8083/phone?p=1234567891</code>报错</p>
<p>请求：<code>http://127.0.0.1:8083/phone?p=12345678910</code>返回12345678910</p>
<p>报错的时候没有提示<code>&quot;&#123;手机号码需要11位数字&#125;&quot;;</code>我指定的message，不明白怎么回事…</p>
<hr>
<h3 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h3><p>在登陆了以后同一个用户占用同一个线程的情况下可以使用ThreadLocal来简化开发，不用每次都传递用户基本信息进来了</p>
<ul>
<li><p>ThreadLocal.set(T)</p>
<p>存放信息</p>
</li>
<li><p>ThreadLocal.get()</p>
<p>取出信息</p>
</li>
<li><p>ThreadLocal.remove()</p>
<p>释放ThreadLoca</p>
</li>
</ul>
<p>可以通过拦截器来实现设置存放信息、释放ThreadLocal</p>
<p>工具类声明静态变量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kirari.dashijian.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreaddLocalUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span>  <span class="type">ThreadLocal</span> <span class="variable">THREAD_LOCAL</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">get</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (T) THREAD_LOCAL.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(Object object)</span>&#123;</span><br><span class="line">        THREAD_LOCAL.set(object);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span>&#123;</span><br><span class="line">        THREAD_LOCAL.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>拦截器中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">     	登录判断逻辑</span></span><br><span class="line"><span class="comment">          */</span>  </span><br><span class="line">            </span><br><span class="line">     	<span class="type">HashMap</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        user.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;krari&quot;</span>);</span><br><span class="line">        user.put(<span class="string">&quot;age&quot;</span>,<span class="number">18</span>);</span><br><span class="line">        THREAD_LOCAL.set(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     * 资源方法运行后运行,没有资源返回不会执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="comment">//        HandlerInterceptor.super.postHandle(request, response, handler, modelAndView);</span></span><br><span class="line">        log.info(<span class="string">&quot;2222222222&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 视图渲染后运行，最后运行</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        THREAD_LOCAL.remove();</span><br><span class="line">        log.info(<span class="string">&quot;3333333333&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在程序中想使用用户信息的时候就可以使用ThreadLocal.get()就能获取到用户的信息了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;String,Object&gt; user = (HashMap&lt;String, Object&gt;) THREAD_LOCAL.get();</span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) user.get(<span class="string">&quot;name&quot;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="Json数据格式化与映射"><a href="#Json数据格式化与映射" class="headerlink" title="Json数据格式化与映射"></a>Json数据格式化与映射</h3><p>使用Json转化数据格式为普通类的属性时需要数据转化或映射的时候的注解 </p>
<h4 id="格式化-JsonFormat"><a href="#格式化-JsonFormat" class="headerlink" title="格式化@JsonFormat"></a>格式化<code>@JsonFormat</code></h4><h5 id="格式化时间"><a href="#格式化时间" class="headerlink" title="格式化时间"></a>格式化时间</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Event</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonFormat(shape = JsonFormat.Shape.STRING, pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date eventDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>转化格式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;eventDate\&quot;:\&quot;2024/06/09 21:45:00\&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="type">Event</span> <span class="variable">event</span> <span class="operator">=</span> objectMapper.readValue(json, Event.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(event.getEventDate()); <span class="comment">// 输出 2024-06-09 21:45:00 对应的 Date 对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>JsonFormat</code>的其他属性：</p>
<ul>
<li><p><code>shape</code>: 指定数据的形状，如 <code>JsonFormat.Shape.STRING</code> 表示将数据序列化为字符串。</p>
</li>
<li><p><code>pattern</code>: 定义日期时间的格式模式，如 <code>&quot;yyyy-MM-dd HH:mm:ss&quot;</code>。</p>
</li>
<li><p><code>timezone</code>: 指定时区，如 <code>&quot;GMT+8&quot;</code> 或 <code>&quot;UTC&quot;</code>。</p>
</li>
<li><p><code>locale</code>: 指定语言环境，如 <code>&quot;en_US&quot;</code>。</p>
</li>
</ul>
<p>除了常用的格式化时间以外，还有其他特殊的用法</p>
<h5 id="格式化数字"><a href="#格式化数字" class="headerlink" title="格式化数字"></a>格式化数字</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonFormat(shape = JsonFormat.Shape.STRING, pattern = &quot;###,###.##&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>作用是格式为千分位分隔俩位小数的保留方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>(<span class="number">1234567.89</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> objectMapper.writeValueAsString(product);</span><br><span class="line"></span><br><span class="line">        System.out.println(json); <span class="comment">// 输出 &#123;&quot;price&quot;:&quot;1,234,567.89&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="格式化布尔值"><a href="#格式化布尔值" class="headerlink" title="格式化布尔值"></a>格式化布尔值</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonFormat(shape = JsonFormat.Shape.NUMBER)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> active;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">boolean</span> active)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.active = active;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">true</span>); <span class="comment">// 将 active 设置为 true</span></span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> objectMapper.writeValueAsString(user);</span><br><span class="line"></span><br><span class="line">        System.out.println(json); <span class="comment">// 输出 &#123;&quot;active&quot;:1&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>反向序列化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;active\&quot;:1&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> objectMapper.readValue(json, User.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(user.isActive()); <span class="comment">// 输出 true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Json与类属性的映射"><a href="#Json与类属性的映射" class="headerlink" title="Json与类属性的映射"></a>Json与类属性的映射</h4><p><code>@JsonProperty</code> 是 Jackson 库中的一个注解，用于在序列化和反序列化 JSON 时为 Java 对象的属性指定映射的 JSON 字段名称。</p>
<p>用法</p>
<p>user.class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;user_name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;user_age&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> userAge;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>userName</code> 属性会映射到 JSON 的 <code>user_name</code> 字段，而 <code>userAge</code> 属性会映射到 JSON 的 <code>user_age</code> 字段。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUserName(<span class="string">&quot;John&quot;</span>);</span><br><span class="line">        user.setUserAge(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> objectMapper.writeValueAsString(user);</span><br><span class="line"></span><br><span class="line">        System.out.println(json); <span class="comment">// 输出 &#123;&quot;user_name&quot;:&quot;John&quot;,&quot;user_age&quot;:30&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>反序列化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;user_name\&quot;:\&quot;John\&quot;,\&quot;user_age\&quot;:30&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> objectMapper.readValue(json, User.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(user.getUserName()); <span class="comment">// 输出 John</span></span><br><span class="line">        System.out.println(user.getUserAge()); <span class="comment">// 输出 30</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更多</p>
<p><strong>添加默认值</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@JsonProperty(value = &quot;user_name&quot;, defaultValue = &quot;unknown&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;user_age&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> userAge;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>忽略 JSON 中不存在的字段</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonIgnoreProperties(ignoreUnknown = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@JsonProperty(&quot;user_name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;user_age&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> userAge;</span><br><span class="line">	<span class="keyword">private</span> String date;</span><br><span class="line">    ....</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SpringDoc-生成API文档"><a href="#SpringDoc-生成API文档" class="headerlink" title="SpringDoc 生成API文档"></a>SpringDoc 生成API文档</h3><p>pom.xml中引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springdoc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springdoc-openapi-starter-webmvc-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>声明配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">publicApi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">                .group(<span class="string">&quot;public&quot;</span>)</span><br><span class="line">                .pathsToMatch(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Info <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Info</span>()</span><br><span class="line">                .title(<span class="string">&quot;接口测试&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;这是测试一下啊&quot;</span>)</span><br><span class="line">                .license(<span class="keyword">new</span> <span class="title class_">License</span>().name(<span class="string">&quot;Apache 2.0&quot;</span>).url(<span class="string">&quot;http://springdoc.org&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输入<code>localhost:端口号/swagger-ui/index.html</code>访问api文档</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com//blogimage-20240615142713906.webp" alt="SpringDoc的API"></p>
<h3 id="Swagger-生成API文档"><a href="#Swagger-生成API文档" class="headerlink" title="Swagger 生成API文档"></a>Swagger 生成API文档</h3><p>Spring整合swagger</p>
<p>借用knife4j工具进行生成</p>
<p>meavn引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>设置配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过knife4j生成接口文档</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApiInfo</span> <span class="variable">apiInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;2.0&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">Docket</span> <span class="variable">docket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sky.controller&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> docket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置静态资源映射</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/doc.html&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用这个源码成功了，自己配置 的时候失败了….</p>
<h4 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h4><div class="table-container">
<table>
<thead>
<tr>
<th>注解</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Api</td>
<td>用在类上，例如Controller</td>
</tr>
<tr>
<td>@ApiOperation</td>
<td>用在方法上Controller的某个方法标注是什么方法</td>
</tr>
<tr>
<td>@ApiModelProperty</td>
<td>用在实体类的属性上</td>
</tr>
<tr>
<td>@ApiModel</td>
<td>用在实体类上</td>
</tr>
</tbody>
</table>
</div>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;员工管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;这个是登录接口&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;EmployeeLoginVO&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeLoginDTO employeeLoginDTO)</span> </span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com//blogimage-20240615154342042.webp" alt="image-20240615154342042"></p>
<p>实体类上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModel(description = &quot;员工登录时传递的数据模型&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeLoginDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;密码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com//blogimage-20240615154442397.webp" alt="image-20240615154442397"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://blog.kiko2568.com">Kirari</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/posts/f7006e66.html">http://example.com/posts/f7006e66.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Kirari</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="post-meta__tags" href="/tags/Spring/">Spring</a></div><div class="post_share"><div class="social-share" data-image="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com//blog202407130706428.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/be3f90b4.html" title="Meavn入门"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com/%5Cmarkdown20231217_081022.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Meavn入门</div></div></a></div><div class="next-post pull-right"><a href="/posts/1d03dcdc.html" title="初学redis对于微信步数排行榜的想法"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://yee-1312555989.cos.ap-guangzhou.myqcloud.com//blogcover%20(1).webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">初学redis对于微信步数排行榜的想法</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">前置知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bean"><span class="toc-number">2.</span> <span class="toc-text">Bean</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E5%90%8D%E5%AD%97%EF%BC%9A"><span class="toc-number">2.1.</span> <span class="toc-text">Bean的名字：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E6%89%AB%E6%8F%8F"><span class="toc-number">2.2.</span> <span class="toc-text">Bean扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96Bean"><span class="toc-number">2.3.</span> <span class="toc-text">获取Bean</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.1.</span> <span class="toc-text">自动配置的三种方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#AUtowired"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">@AUtowired</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Inject"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">@Inject</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Resource"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">@Resource</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87IOC%E5%AE%B9%E5%99%A8%E5%AF%B9%E8%B1%A1%E8%8E%B7%E5%8F%96Bean"><span class="toc-number">2.3.2.</span> <span class="toc-text">通过IOC容器对象获取Bean</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E9%87%8D%E5%A4%8D"><span class="toc-number">2.4.</span> <span class="toc-text">Bean重复</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Resource%E5%92%8C-Autowired%E3%80%81-Inject%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.4.1.</span> <span class="toc-text">@Resource和@Autowired、@Inject的区别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E8%8C%83%E5%9B%B4"><span class="toc-number">2.5.</span> <span class="toc-text">Bean的作用域范围</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#singleton"><span class="toc-number">2.5.1.</span> <span class="toc-text">singleton</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#prototype"><span class="toc-number">2.5.2.</span> <span class="toc-text">prototype</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E6%B3%A8%E5%86%8C"><span class="toc-number">2.6.</span> <span class="toc-text">Bean注册</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Bean-1"><span class="toc-number">2.6.1.</span> <span class="toc-text">@Bean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#import"><span class="toc-number">2.6.2.</span> <span class="toc-text">@import</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%B7%E6%AD%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">2.7.</span> <span class="toc-text">起步依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="toc-number">2.8.</span> <span class="toc-text">自动装配</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.8.1.</span> <span class="toc-text">自定义注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">2.8.2.</span> <span class="toc-text">自动配置原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.9.</span> <span class="toc-text">注册条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Component"><span class="toc-number">2.10.</span> <span class="toc-text">@Component</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E5%92%8CComponent%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.11.</span> <span class="toc-text">Bean和Component的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E6%94%B6%E8%AF%B7%E6%B1%82"><span class="toc-number">3.</span> <span class="toc-text">接收请求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82"><span class="toc-number">3.1.</span> <span class="toc-text">简单请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AE%BE%E4%B8%BA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">3.2.</span> <span class="toc-text">参数设为实体类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">3.2.1.</span> <span class="toc-text">复杂实体类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E5%8F%82%E6%95%B0"><span class="toc-number">3.3.</span> <span class="toc-text">数组参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E5%8F%82%E6%95%B0"><span class="toc-number">3.4.</span> <span class="toc-text">集合参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%8F%82%E6%95%B0"><span class="toc-number">3.5.</span> <span class="toc-text">日期参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSON%E6%95%B0%E6%8D%AE"><span class="toc-number">3.6.</span> <span class="toc-text">JSON数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-number">3.7.</span> <span class="toc-text">路径参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-number">3.7.1.</span> <span class="toc-text">多个路径参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="toc-number">3.8.</span> <span class="toc-text">请求头</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BC%A0%E5%8F%82%E8%BF%9B%E8%A1%8C%E6%AD%A3%E5%88%99%E9%AA%8C%E8%AF%81"><span class="toc-number">3.9.</span> <span class="toc-text">为传参进行正则验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8"><span class="toc-number">4.</span> <span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF"><span class="toc-number">4.1.</span> <span class="toc-text">会话技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Cookie"><span class="toc-number">4.1.1.</span> <span class="toc-text">Cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Session"><span class="toc-number">4.1.2.</span> <span class="toc-text">Session</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Token"><span class="toc-number">4.1.3.</span> <span class="toc-text">Token</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#JWT%EF%BC%88Json-Web-Token"><span class="toc-number">4.1.3.1.</span> <span class="toc-text">JWT（Json Web Token)</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94"><span class="toc-number">5.</span> <span class="toc-text">响应</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8%E5%92%8C%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">6.</span> <span class="toc-text">拦截器和过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">6.1.</span> <span class="toc-text">过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">6.2.</span> <span class="toc-text">拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E8%A7%84%E5%88%99"><span class="toc-number">6.2.1.</span> <span class="toc-text">拦截规则</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">异常处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">8.</span> <span class="toc-text">事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8%E8%8C%83%E5%9B%B4"><span class="toc-number">8.0.1.</span> <span class="toc-text">事务处理异常范围</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E4%BA%8B%E5%8A%A1-%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA"><span class="toc-number">8.0.2.</span> <span class="toc-text">嵌套事务-传播行为</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97"><span class="toc-number">8.0.3.</span> <span class="toc-text">查看事务日志</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOC-%E9%9D%A2%E5%90%91%E5%88%87%E7%89%87%E7%BC%96%E7%A8%8B"><span class="toc-number">9.</span> <span class="toc-text">AOC-面向切片编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AOC%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">9.1.</span> <span class="toc-text">AOC的核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">9.2.</span> <span class="toc-text">AOP实现原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5"><span class="toc-number">9.3.</span> <span class="toc-text">通知</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5-Advice-%E7%B1%BB%E5%9E%8B"><span class="toc-number">9.3.1.</span> <span class="toc-text">通知(Advice)类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E9%80%9A%E7%9F%A5%E6%97%B6%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">9.3.2.</span> <span class="toc-text">多个通知时执行顺序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E9%A1%BA%E5%BA%8F"><span class="toc-number">9.3.2.1.</span> <span class="toc-text">默认顺序</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%BA%E5%BA%8F"><span class="toc-number">9.3.2.2.</span> <span class="toc-text">自定义顺序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E7%9B%B8%E5%90%8C%E7%9A%84%E5%88%87%E5%85%A5%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%8A%BD%E5%8F%96"><span class="toc-number">9.4.</span> <span class="toc-text">多个相同的切入点表达式抽取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E5%85%A5%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">9.5.</span> <span class="toc-text">切入点表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#execution"><span class="toc-number">9.5.1.</span> <span class="toc-text">execution</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E5%88%A4%E6%96%AD"><span class="toc-number">9.5.1.1.</span> <span class="toc-text">复杂判断</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#annotation-%E3%80%81-within"><span class="toc-number">9.5.2.</span> <span class="toc-text">@annotation()、@within()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8aop%E4%B8%AD%E8%8E%B7%E5%8F%96%E8%BF%9E%E6%8E%A5%E7%82%B9%E4%BF%A1%E6%81%AF"><span class="toc-number">9.6.</span> <span class="toc-text">在aop中获取连接点信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringDATA%E8%87%AA%E5%8A%A8%E8%AE%BE%E7%BD%AECRUD"><span class="toc-number">10.</span> <span class="toc-text">SpringDATA自动设置CRUD</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">11.</span> <span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E5%93%8D%E5%BA%94%E6%A0%BC%E5%BC%8F%E7%9A%84%E7%BB%9F%E4%B8%80"><span class="toc-number">11.1.</span> <span class="toc-text">对于响应格式的统一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="toc-number">11.2.</span> <span class="toc-text">配置信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%8D%E5%90%8C%E6%96%B9%E5%BC%8F%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E9%A1%BA%E5%BA%8F"><span class="toc-number">11.2.1.</span> <span class="toc-text">配置文件不同方式、配置文件顺序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2"><span class="toc-number">11.2.2.</span> <span class="toc-text">多个环境部署</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%95%E6%96%87%E4%BB%B6"><span class="toc-number">11.2.2.1.</span> <span class="toc-text">单文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E6%96%87%E4%BB%B6"><span class="toc-number">11.2.2.2.</span> <span class="toc-text">多文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%94%E5%88%86%E7%BB%84"><span class="toc-number">11.2.2.3.</span> <span class="toc-text">多文件且分组</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%AE%9E%E7%8E%B0Get%E3%80%81Set%E3%80%81ToString"><span class="toc-number">11.3.</span> <span class="toc-text">自动实现Get、Set、ToString</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-number">11.4.</span> <span class="toc-text">日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8"><span class="toc-number">11.5.</span> <span class="toc-text">本地存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E5%8C%96"><span class="toc-number">11.6.</span> <span class="toc-text">参数配置化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JsonIgnore"><span class="toc-number">11.7.</span> <span class="toc-text">JsonIgnore</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E8%BF%9B%E8%A1%8C%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C"><span class="toc-number">11.8.</span> <span class="toc-text">使用注解进行参数校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%AF%B9%E5%A4%9A%E4%B8%AA%E8%AF%B7%E6%B1%82%E7%9A%84%E9%80%82%E5%BA%94"><span class="toc-number">11.9.</span> <span class="toc-text">同一个实体类对多个请求的适应</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DTO%E3%80%81VO%E3%80%81PO"><span class="toc-number">11.9.1.</span> <span class="toc-text">DTO、VO、PO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">11.9.2.</span> <span class="toc-text">分类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E8%BF%9B%E8%A1%8C%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C"><span class="toc-number">11.10.</span> <span class="toc-text">注解进行参数校验的原理以及自定义校验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3"><span class="toc-number">11.10.1.</span> <span class="toc-text">自定义校验注解</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ThreadLocal"><span class="toc-number">11.11.</span> <span class="toc-text">ThreadLocal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Json%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%B8%8E%E6%98%A0%E5%B0%84"><span class="toc-number">11.12.</span> <span class="toc-text">Json数据格式化与映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96-JsonFormat"><span class="toc-number">11.12.1.</span> <span class="toc-text">格式化@JsonFormat</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%97%B6%E9%97%B4"><span class="toc-number">11.12.1.1.</span> <span class="toc-text">格式化时间</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%95%B0%E5%AD%97"><span class="toc-number">11.12.1.2.</span> <span class="toc-text">格式化数字</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B8%83%E5%B0%94%E5%80%BC"><span class="toc-number">11.12.1.3.</span> <span class="toc-text">格式化布尔值</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Json%E4%B8%8E%E7%B1%BB%E5%B1%9E%E6%80%A7%E7%9A%84%E6%98%A0%E5%B0%84"><span class="toc-number">11.12.2.</span> <span class="toc-text">Json与类属性的映射</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringDoc-%E7%94%9F%E6%88%90API%E6%96%87%E6%A1%A3"><span class="toc-number">11.13.</span> <span class="toc-text">SpringDoc 生成API文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Swagger-%E7%94%9F%E6%88%90API%E6%96%87%E6%A1%A3"><span class="toc-number">11.14.</span> <span class="toc-text">Swagger 生成API文档</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">11.14.1.</span> <span class="toc-text">常用注解</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: rgb(0,0,0,0)"><div id="footer-wrap"><div id="footer-bar-links"><div id="footer_left"><div class="copyright">&copy;2023 - 2024 By <a target="_blank" rel="noopener" href="https://kiko2568.top">Kirari</a></div><span class="footer-separator">|</span><div class="framework-info"><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><div id="footer_right"><div class="footer_custom_text"><a href="https://icp.gov.moe/?keyword=20232568" target="_blank">萌ICP备20232568号</a>|<a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/shouye.html">桂ICP备2024029447号-1</a></div></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-comments-tau.vercel.app/',
      region: 'ap-shanghai',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(init,0)
    else getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(init)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-comments-tau.vercel.app/',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
      
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script src="/js/randomTopImg.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>